<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B/F Cinema - Streaming Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* =========== ROOT VARIABLES =========== */
        :root {
            --primary: #e50914;
            --primary-dark: #b20710;
            --primary-glow: #ff3b30;
            --secondary: #221f1f;
            --light-dark: #333;
            --text-light: #fff;
            --text-gray: #999;
            --bg-dark: #000;
            --bg-light: #f5f5f5;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #3498db;
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            
            --light-bg: #f8f9fa;
            --light-text: #333;
            --light-card: #ffffff;
            --light-border: #dee2e6;
        }
        
        /* =========== RESET & BASE STYLES =========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body.light-theme {
            background-color: var(--light-bg);
            color: var(--light-text);
        }
        
        /* =========== LANDING PAGE =========== */
        #landing-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            background-color: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        #landing-page.hidden {
            opacity: 0;
            visibility: hidden;
            transition: opacity 1.5s ease, visibility 1.5s ease;
        }
        
        .Cinema-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.9)),
                        url('https://images.unsplash.com/photo-1536440136628-849c177e76a1?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
        }
        
        .logo-container {
            position: relative;
            z-index: 10;
            text-align: center;
            width: 100%;
            max-width: 1200px;
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .custom-logo {
            margin-bottom: 30px;
            opacity: 0;
            transform: scale(0.8);
            animation: fade-in-zoom 3s ease forwards;
            animation-delay: 0.5s;
        }
        
        .logo-text {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            line-height: 1.2;
            text-align: center;
            letter-spacing: 2px;
        }
        
        .logo-main {
            font-size: 6.5rem;
            color: var(--primary);
            text-shadow: 0 0 20px rgba(229, 9, 20, 0.7);
            margin-bottom: 10px;
            letter-spacing: 8px;
        }
        
        .logo-subtitle {
            font-size: 3.5rem;
            color: var(--text-light);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            margin-bottom: 10px;
            letter-spacing: 6px;
        }
        
        .logo-tagline {
            font-size: 2.2rem;
            color: var(--text-light);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            letter-spacing: 4px;
        }
        
        .slogan {
            font-size: 1.8rem;
            font-weight: 300;
            letter-spacing: 2px;
            margin-top: 20px;
            opacity: 0;
            transform: translateY(20px);
            animation: fade-up 2s ease forwards;
            animation-delay: 4s;
            color: var(--text-gray);
        }
        
        /* =========== AUTH BUTTONS =========== */
        .auth-container {
            margin-top: 50px;
            opacity: 0;
            transform: translateY(30px);
            animation: fade-up 1.5s ease forwards;
            animation-delay: 5.5s;
        }
        
        .auth-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .auth-btn {
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            font-family: 'Poppins', sans-serif;
            min-width: 180px;
        }
        
        .auth-btn-primary {
            background-color: var(--primary);
            color: var(--text-light);
            box-shadow: 0 5px 15px rgba(229, 9, 20, 0.4);
        }
        
        .auth-btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(229, 9, 20, 0.6);
        }
        
        .auth-btn-outline {
            background-color: transparent;
            color: var(--text-light);
            border: 2px solid var(--text-light);
        }
        
        .auth-btn-outline:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }
        
        .admin-login-text {
            margin-top: 20px;
            color: var(--primary);
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        /* =========== LANDING FOOTER =========== */
        .landing-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 25px 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
            z-index: 20;
            opacity: 0;
            animation: fade-in 2s ease forwards;
            animation-delay: 6s;
        }
        
        .landing-footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .footer-left {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }
        
        .footer-left span {
            color: var(--primary);
            font-weight: 600;
        }
        
        .footer-right {
            display: flex;
            gap: 20px;
        }
        
        .footer-link {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s;
            font-size: 0.9rem;
        }
        
        .footer-link:hover {
            color: var(--primary);
        }
        
        /* =========== MODALS =========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 20000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.7), 0 0 30px rgba(229, 9, 20, 0.2);
            border: 1px solid rgba(229, 9, 20, 0.2);
            transform: translateY(20px);
            opacity: 0;
            animation: modal-appear 0.5s ease forwards;
        }
        
        body.light-theme .modal-content {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            padding: 30px;
            background: linear-gradient(90deg, #e50914, #b20710);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .modal-title {
            font-size: 28px;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 32px;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
        }
        
        .modal-body {
            padding: 35px;
        }
        
        body.light-theme .modal-body {
            color: var(--light-text);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            font-size: 1.1rem;
            color: #ddd;
        }
        
        body.light-theme .form-label {
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 16px 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-light);
            font-size: 16px;
            transition: all 0.3s;
        }
        
        body.light-theme .form-control {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: var(--light-text);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 15px rgba(229, 9, 20, 0.2);
        }
        
        .form-footer {
            margin-top: 25px;
            text-align: center;
            color: #aaa;
            font-size: 1rem;
        }
        
        body.light-theme .form-footer {
            color: #666;
        }
        
        .form-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s;
        }
        
        /* =========== MAIN PLATFORM =========== */
        #main-platform {
            display: none;
            opacity: 0;
            width: 100%;
            min-height: 100vh;
        }
        
        #main-platform.active {
            display: block;
            opacity: 1;
            animation: fade-in 1.5s ease forwards;
        }
        
        /* =========== ADMIN PANEL =========== */
        #admin-panel {
            display: none;
            opacity: 0;
            width: 100%;
            min-height: 100vh;
        }
        
        #admin-panel.active {
            display: block;
            opacity: 1;
            animation: fade-in 1.5s ease forwards;
        }
        
        /* =========== NAVIGATION =========== */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            background-color: rgba(0, 0, 0, 0.9);
            border-bottom: 1px solid rgba(229, 9, 20, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        body.light-theme .navbar {
            background-color: rgba(248, 249, 250, 0.95);
            border-bottom: 1px solid rgba(229, 9, 20, 0.2);
        }
        
        .nav-brand {
            display: flex;
            align-items: center;
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--text-light);
        }
        
        body.light-theme .nav-brand {
            color: var(--light-text);
        }
        
        .nav-brand .brand-primary {
            color: var(--primary);
        }
        
        /* =========== HAMBURGER MENU =========== */
        .hamburger-menu {
            position: relative;
            z-index: 1001;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 28px;
            cursor: pointer;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        body.light-theme .menu-toggle {
            color: var(--light-text);
        }
        
        .menu-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .menu-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            min-width: 250px;
            display: none;
            overflow: hidden;
            border: 1px solid rgba(229, 9, 20, 0.2);
            z-index: 1001;
        }
        
        body.light-theme .menu-dropdown {
            background: linear-gradient(145deg, #ffffff, #f5f5f5);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .menu-dropdown.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        .menu-header {
            padding: 20px;
            background: linear-gradient(90deg, #e50914, #b20710);
            color: white;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .menu-header h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .menu-header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .menu-items {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: var(--text-light);
            text-decoration: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        body.light-theme .menu-item {
            color: var(--light-text);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
            padding-left: 25px;
        }
        
        body.light-theme .menu-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .menu-item.active {
            background-color: rgba(229, 9, 20, 0.1);
            border-left: 4px solid var(--primary);
        }
        
        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        body.light-theme .theme-toggle {
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .theme-label {
            display: flex;
            align-items: center;
        }
        
        .theme-label i {
            margin-right: 15px;
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
        
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .theme-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .theme-slider {
            background-color: var(--primary);
        }
        
        input:checked + .theme-slider:before {
            transform: translateX(26px);
        }
        
        /* =========== ADMIN SIDEBAR =========== */
        .admin-sidebar {
            width: 280px;
            background: linear-gradient(180deg, #0d0d0d 0%, #1a1a1a 100%);
            border-right: 1px solid rgba(229, 9, 20, 0.2);
            padding: 30px 0;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            z-index: 1000;
            transform: translateX(-280px);
            transition: transform 0.3s ease;
        }
        
        body.light-theme .admin-sidebar {
            background: linear-gradient(180deg, #ffffff 0%, #f5f5f5 100%);
            border-right: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .admin-sidebar.active {
            transform: translateX(0);
        }
        
        .sidebar-header {
            padding: 0 25px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }
        
        body.light-theme .sidebar-header {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-brand {
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            font-weight: 900;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .admin-email {
            color: var(--text-gray);
            font-size: 0.9rem;
            word-break: break-all;
        }
        
        body.light-theme .admin-email {
            color: #666;
        }
        
        .nav-menu {
            list-style: none;
            padding: 0 15px;
        }
        
        .nav-item {
            margin-bottom: 5px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            color: var(--text-light);
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        body.light-theme .nav-link {
            color: var(--light-text);
        }
        
        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.05);
            padding-left: 25px;
            transform: translateX(5px);
        }
        
        body.light-theme .nav-link:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .nav-link.active {
            background-color: rgba(229, 9, 20, 0.15);
            border-left: 4px solid var(--primary);
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(229, 9, 20, 0.2);
        }
        
        .sidebar-footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.light-theme .sidebar-footer {
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        /* =========== ADMIN MAIN CONTENT =========== */
        .admin-main {
            flex: 1;
            padding: 20px;
            margin-left: 0;
            transition: margin-left 0.3s ease;
        }
        
        .admin-main.sidebar-open {
            margin-left: 280px;
        }
        
        .admin-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.light-theme .admin-header {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .admin-menu-toggle {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        body.light-theme .admin-menu-toggle {
            color: var(--light-text);
        }
        
        .admin-menu-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .admin-header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* =========== BUTTONS =========== */
        .btn {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: var(--text-light);
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(229, 9, 20, 0.4);
        }
        
        .btn-secondary {
            background-color: var(--light-dark);
            color: var(--text-light);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        body.light-theme .btn-secondary {
            background-color: #e9ecef;
            color: var(--light-text);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-info {
            background-color: var(--info);
            color: white;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }
        
        /* =========== CONTENT SECTIONS =========== */
        .content-section {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .content-section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        /* =========== MAIN CONTENT SECTIONS =========== */
        .main-content {
            min-height: calc(100vh - 140px);
        }
        
        /* Movies Section */
        #movies-section {
            display: block;
        }
        
        #downloads-section, #profile-section {
            display: none;
        }
        
        /* Hero Section */
        .hero {
            padding: 100px 40px;
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                        url('https://images.unsplash.com/photo-1489599809516-9827b6d1cf13?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            text-align: center;
        }
        
        body.light-theme .hero {
            background: linear-gradient(rgba(248, 249, 250, 0.9), rgba(248, 249, 250, 0.9)), 
                        url('https://images.unsplash.com/photo-1489599809516-9827b6d1cf13?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
        }
        
        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: var(--text-light);
        }
        
        body.light-theme .hero h1 {
            color: var(--light-text);
        }
        
        /* =========== CONTAINERS & SECTIONS =========== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .section-title {
            font-size: 2rem;
            margin: 50px 0 30px;
            color: var(--text-light);
            border-left: 4px solid var(--primary);
            padding-left: 15px;
        }
        
        body.light-theme .section-title {
            color: var(--light-text);
        }
        
        /* =========== MOVIES GRID =========== */
        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }
        
        .movie-card {
            background: var(--light-dark);
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        body.light-theme .movie-card {
            background: var(--light-card);
            border: 1px solid var(--light-border);
        }
        
        .movie-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 25px rgba(229, 9, 20, 0.2);
        }
        
        .movie-poster {
            width: 100%;
            height: 350px;
            object-fit: cover;
        }
        
        .movie-info {
            padding: 20px;
        }
        
        .movie-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--text-light);
        }
        
        body.light-theme .movie-title {
            color: var(--light-text);
        }
        
        .movie-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-gray);
            font-size: 0.9rem;
        }
        
        body.light-theme .movie-meta {
            color: #666;
        }
        
        .movie-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        /* =========== ADMIN CARDS & FORMS =========== */
        .admin-container {
            padding: 40px;
            min-height: calc(100vh - 160px);
        }
        
        .admin-header {
            margin-bottom: 40px;
            text-align: center;
        }
        
        .admin-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .admin-card {
            background: var(--light-dark);
            padding: 30px;
            border-radius: 10px;
            border: 1px solid rgba(229, 9, 20, 0.3);
        }
        
        body.light-theme .admin-card {
            background: var(--light-card);
            border: 1px solid rgba(229, 9, 20, 0.2);
        }
        
        .admin-card h3 {
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .admin-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-light);
            font-size: 16px;
        }
        
        body.light-theme .form-input {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: var(--light-text);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* =========== FILE INFO STYLES =========== */
        .file-info {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            display: none;
            font-size: 0.9rem;
        }
        
        body.light-theme .file-info {
            background: rgba(0, 0, 0, 0.05);
        }
        
        .file-info strong {
            color: var(--primary);
            display: block;
            margin-bottom: 5px;
        }
        
        .file-info small {
            color: var(--text-gray);
        }
        
        body.light-theme .file-info small {
            color: #666;
        }
        
        /* =========== WASABI INFO =========== */
        .wasabi-info {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .wasabi-info h4 {
            color: var(--info);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .wasabi-info p {
            margin: 5px 0;
            font-size: 0.9rem;
        }
        
        /* =========== UPLOAD STATUS =========== */
        .upload-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .upload-status.processing {
            display: block;
            background-color: rgba(243, 156, 18, 0.1);
            border: 1px solid var(--warning);
        }
        
        .upload-status.success {
            display: block;
            background-color: rgba(46, 204, 113, 0.1);
            border: 1px solid var(--success);
        }
        
        .upload-status.error {
            display: block;
            background-color: rgba(229, 9, 20, 0.1);
            border: 1px solid var(--primary);
        }
        
        /* =========== PROGRESS BAR =========== */
        .progress-container {
            width: 100%;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        body.light-theme .progress-container {
            background-color: rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* =========== TABLES =========== */
        .table-responsive {
            overflow-x: auto;
            border-radius: 10px;
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }
        
        body.light-theme .table-responsive {
            background: linear-gradient(145deg, #ffffff, #f5f5f5);
        }
        
        .admin-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 800px;
        }
        
        .admin-table th {
            background: linear-gradient(90deg, #e50914, #b20710);
            color: white;
            padding: 18px 20px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .admin-table td {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--text-gray);
        }
        
        body.light-theme .admin-table td {
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            color: #666;
        }
        
        /* Badge styles */
        .badge {
            background: rgba(229, 9, 20, 0.2);
            color: var(--primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        body.light-theme .badge {
            background: rgba(229, 9, 20, 0.1);
        }
        
        /* =========== VIDEO PLAYER =========== */
        .video-player-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 30000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .video-player-container.active {
            display: flex;
        }
        
        .video-player {
            width: 90%;
            max-width: 1200px;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .video-element {
            width: 100%;
            height: 70vh;
            background: #000;
        }
        
        .close-player {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
        }
        
        /* =========== FOOTERS =========== */
        .main-footer {
            background-color: var(--secondary);
            padding: 60px 0 30px;
            margin-top: 80px;
            width: 100%;
        }
        
        body.light-theme .main-footer {
            background-color: #e9ecef;
            border-top: 1px solid var(--light-border);
        }
        
        .admin-footer {
            background-color: var(--secondary);
            padding: 60px 0 30px;
            margin-top: 80px;
            width: 100%;
        }
        
        body.light-theme .admin-footer {
            background-color: #e9ecef;
        }
        
        .main-footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }
        
        .footer-column h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--text-light);
        }
        
        body.light-theme .footer-column h3 {
            color: var(--light-text);
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: var(--text-gray);
            text-decoration: none;
            transition: color 0.3s;
        }
        
        body.light-theme .footer-links a {
            color: #666;
        }
        
        .footer-links a:hover {
            color: var(--primary);
        }
        
        .copyright {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-gray);
            font-size: 0.9rem;
        }
        
        body.light-theme .copyright {
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            color: #666;
        }
        
        /* =========== NOTIFICATION =========== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 30000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateX(100%);
            transition: transform 0.5s ease;
            display: none;
        }
        
        .notification.show {
            display: block;
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: var(--success);
            color: white;
        }
        
        .notification.error {
            background-color: var(--primary);
            color: white;
        }
        
        .notification.info {
            background-color: var(--warning);
            color: white;
        }
        
        /* =========== ANTI-PIRACY =========== */
        .anti-piracy {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 40000;
            display: none;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            padding: 40px;
        }
        
        .anti-piracy.active {
            display: flex;
        }
        
        .anti-piracy h2 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        
        /* =========== LOADING OVERLAY =========== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 20000;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }
        
        /* =========== STATS CARDS =========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid var(--primary);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        body.light-theme .stat-card {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-left: 5px solid var(--primary);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        
        .stat-content h3 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            color: var(--text-light);
        }
        
        body.light-theme .stat-content h3 {
            color: var(--light-text);
        }
        
        /* =========== DRAG AND DROP AREA =========== */
        .drag-drop-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.05);
        }
        
        body.light-theme .drag-drop-area {
            border: 2px dashed rgba(0, 0, 0, 0.3);
            background: rgba(0, 0, 0, 0.05);
        }
        
        .drag-drop-area:hover {
            border-color: var(--primary);
            background: rgba(229, 9, 20, 0.05);
        }
        
        .drag-drop-area i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
            display: block;
        }
        
        /* =========== UPLOAD QUEUE =========== */
        .upload-queue {
            margin-top: 30px;
            border: 1px solid rgba(229, 9, 20, 0.2);
            border-radius: 10px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .upload-queue h4 {
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .upload-item {
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .upload-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .upload-item-title {
            font-weight: 600;
            color: var(--text-light);
        }
        
        .upload-item-status {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .upload-item-status.pending {
            background: rgba(243, 156, 18, 0.2);
            color: var(--warning);
        }
        
        .upload-item-status.uploading {
            background: rgba(52, 152, 219, 0.2);
            color: var(--info);
        }
        
        .upload-item-status.completed {
            background: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }
        
        .upload-item-status.failed {
            background: rgba(231, 76, 60, 0.2);
            color: var(--danger);
        }
        
        .upload-progress-container {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid rgba(229, 9, 20, 0.3);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
        }
        
        /* =========== ANIMATIONS =========== */
        @keyframes fade-in-zoom {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes fade-up {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fade-in {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        @keyframes modal-appear {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideDown {
            0% { opacity: 0; transform: translateY(-10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }
        
        /* =========== RESPONSIVE =========== */
        @media (max-width: 992px) {
            .admin-main.sidebar-open {
                margin-left: 0;
            }
            
            .admin-sidebar {
                box-shadow: 5px 0 30px rgba(0, 0, 0, 0.3);
            }
            
            .sidebar-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
                display: none;
            }
            
            .sidebar-overlay.active {
                display: block;
            }
        }
        
        @media (max-width: 768px) {
            .logo-main {
                font-size: 4rem;
                letter-spacing: 4px;
            }
            
            .logo-subtitle {
                font-size: 2.5rem;
                letter-spacing: 3px;
            }
            
            .logo-tagline {
                font-size: 1.8rem;
                letter-spacing: 2px;
            }
            
            .navbar {
                padding: 15px;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .landing-footer-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .main-footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .menu-dropdown {
                position: fixed;
                top: 0;
                right: 0;
                width: 280px;
                height: 100vh;
                border-radius: 0;
                box-shadow: -5px 0 30px rgba(0, 0, 0, 0.3);
            }
            
            .menu-header {
                padding: 25px 20px;
            }
            
            .admin-main {
                padding: 15px;
            }
            
            .admin-header-actions {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .table-actions {
                flex-direction: column;
                gap: 5px;
            }
        }
        
        @media (max-width: 480px) {
            .admin-main {
                padding: 10px;
            }
            
            .section-title {
                font-size: 1.6rem;
            }
            
            .admin-table th,
            .admin-table td {
                padding: 12px 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Sidebar Overlay (for mobile) -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Landing Page -->
    <section id="landing-page">
        <div class="Cinema-background"></div>
        <div class="logo-container">
            <div class="custom-logo">
                <div class="logo-text">
                    <div class="logo-main">B/F Cinema</div>
                    <div class="logo-subtitle">MOVIES</div>
                    <div class="logo-tagline">STREAMING PLATFORM</div>
                </div>
            </div>
            
            <p class="slogan">
                Your Home of Unlimited Entertainment
            </p>
            
            <div class="auth-container">
                <div class="auth-buttons">
                    <button class="auth-btn auth-btn-outline" id="login-intro-btn">
                        <i class="fas fa-sign-in-alt"></i> User Login
                    </button>
                    <button class="auth-btn auth-btn-primary" id="register-intro-btn">
                        <i class="fas fa-user-plus"></i> User Sign Up
                    </button>
                </div>
                <p class="admin-login-text">
                     
                </p>
            </div>
        </div>
        
        <!-- Landing Page Footer -->
        <div class="landing-footer">
            <div class="landing-footer-content">
                <div class="footer-left">
                    &copy; <span>2026</span> B/F Cinema Movies. All rights reserved.
                </div>
                <div class="footer-right">
                    <a href="https://wa.me/254700505325" class="footer-link" target="_blank">
                        <i class="fab fa-whatsapp"></i>
                        <span>+254 700 505325</span>
                    </a>
                    <a href="mailto:bfCinemamovies@gmail.com" class="footer-link">
                        <i class="fas fa-envelope"></i>
                        <span>bfCinemamovies@gmail.com</span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- User Login Modal -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Login</h3>
                <button class="close-modal" id="close-login">&times;</button>
            </div>
            <div class="modal-body">
                <form id="login-form">
                    <div class="form-group">
                        <label class="form-label" for="login-email">Email or Phone Number</label>
                        <input type="text" class="form-control" id="login-email" placeholder="Enter your email or phone" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="login-password">Password</label>
                        <input type="password" class="form-control" id="login-password" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="auth-btn auth-btn-primary" style="width: 100%; margin-top: 10px;">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
                <div class="form-footer">
                    <p>Don't have an account? <a href="#" id="switch-to-register">Sign up here</a></p>
                    <p><a href="#" id="forgot-password">Forgot password?</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- User Register Modal -->
    <div class="modal" id="register-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create User Account</h3>
                <button class="close-modal" id="close-register">&times;</button>
            </div>
            <div class="modal-body">
                <form id="register-form">
                    <div class="form-group">
                        <label class="form-label" for="register-name">Full Name</label>
                        <input type="text" class="form-control" id="register-name" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="register-email">Email Address</label>
                        <input type="email" class="form-control" id="register-email" placeholder="Enter your email address" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="register-phone">Phone Number</label>
                        <input type="tel" class="form-control" id="register-phone" placeholder="Enter your phone number" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="register-password">Password</label>
                        <input type="password" class="form-control" id="register-password" placeholder="Create a password (min. 8 characters)" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="register-confirm">Confirm Password</label>
                        <input type="password" class="form-control" id="register-confirm" placeholder="Confirm your password" required>
                    </div>
                    <button type="submit" class="auth-btn auth-btn-primary" style="width: 100%; margin-top: 10px;">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </form>
                <div class="form-footer">
                    <p>Already have an account? <a href="#" id="switch-to-login">Login here</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Enhanced Payment Modal -->
    <div class="modal" id="payment-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-shopping-cart"></i> Purchase Movie</h3>
                <button class="close-modal" id="close-payment">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Step Indicator -->
                <div class="payment-steps" style="display: flex; justify-content: space-between; margin-bottom: 30px; position: relative;">
                    <div class="step active" data-step="1" style="text-align: center; flex: 1; position: relative; z-index: 1;">
                        <div class="step-circle" style="width: 40px; height: 40px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; font-weight: bold;">1</div>
                        <div class="step-label" style="font-size: 0.9rem; color: var(--primary);">Send Money</div>
                    </div>
                    <div class="step" data-step="2" style="text-align: center; flex: 1; position: relative; z-index: 1;">
                        <div class="step-circle" style="width: 40px; height: 40px; background: var(--text-gray); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; font-weight: bold;">2</div>
                        <div class="step-label" style="font-size: 0.9rem; color: var(--text-gray);">Paste Message</div>
                    </div>
                    <div class="step" data-step="3" style="text-align: center; flex: 1; position: relative; z-index: 1;">
                        <div class="step-circle" style="width: 40px; height: 40px; background: var(--text-gray); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; font-weight: bold;">3</div>
                        <div class="step-label" style="font-size: 0.9rem; color: var(--text-gray);">Get Receipt</div>
                    </div>
                    <div style="position: absolute; top: 20px; left: 20px; right: 20px; height: 2px; background: var(--text-gray); z-index: 0;"></div>
                </div>
                
                <div class="payment-instructions">
                    <div id="step-1-content">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">
                            <i class="fas fa-mobile-alt"></i> Step 1: Send Money via MPesa
                        </h4>
                        <div style="background: rgba(46, 204, 113, 0.1); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <p><strong>Follow these steps:</strong></p>
                            <ol style="margin-left: 20px; margin-top: 10px;">
                                <li>Go to MPesa on your phone</li>
                                <li>Select <strong>"Lipa Na M-Pesa"</strong></li>
                                <li>Select <strong>"Pay Bill"</strong></li>
                                <li>Enter Business Number: <strong style="color: var(--primary); font-size: 1.2rem;">7048202</strong></li>
                                <li>Enter Account Number: <strong style="color: var(--primary);">BFMOVIES</strong></li>
                                <li>Enter Amount: <strong style="color: var(--primary);">KES 30</strong></li>
                                <li>Enter your MPesa PIN and send</li>
                                <li>Wait for confirmation message</li>
                            </ol>
                        </div>
                        
                        <div style="text-align: center; margin: 20px 0;">
                            <button class="btn btn-primary" id="next-step-btn" style="min-width: 150px;">
                                <i class="fas fa-arrow-right"></i> Next Step
                            </button>
                        </div>
                    </div>
                    
                    <div id="step-2-content" style="display: none;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">
                            <i class="fas fa-paste"></i> Step 2: Paste MPesa Message
                        </h4>
                        
                        <form id="payment-form">
                            <input type="hidden" id="payment-movie-id">
                            <input type="hidden" id="payment-movie-title">
                            
                            <div class="form-group">
                                <label class="form-label">Your Phone Number</label>
                                <input type="tel" class="form-control" id="payment-phone" 
                                       placeholder="2547XXXXXXXX" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Transaction Code *</label>
                                <input type="text" class="form-control" id="transaction-code" 
                                       placeholder="Enter the transaction code from MPesa (e.g., UA7QM35P3M)" 
                                       pattern="[A-Z0-9]{10}" 
                                       title="Enter the 10-character transaction code" required>
                                <small style="color: var(--text-gray); display: block; margin-top: 5px;">
                                    Example: UA7QM35P3M
                                </small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Complete MPesa Message *</label>
                                <textarea class="form-control" id="mpesa-message" rows="4" 
                                          placeholder="Paste the complete MPesa message here...
Example: 
UA7QM35P3M Confirmed. Ksh30.00 paid to PETER KINUTHIA NGIGI. on 7/1/26 at 7:05 AM. New M-PESA balance is Ksh1,230.00." required></textarea>
                                <small style="color: var(--text-gray); display: block; margin-top: 5px;">
                                    Copy the entire message from your MPesa SMS
                                </small>
                            </div>
                            
                            <div id="payment-status" style="margin: 15px 0;"></div>
                            
                            <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                                <button type="button" class="btn btn-secondary" id="prev-step-btn">
                                    <i class="fas fa-arrow-left"></i> Previous
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-check-circle"></i> Verify Payment
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div class="modal" id="receipt-modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header" style="background: linear-gradient(90deg, #2ecc71, #27ae60);">
                <h3 class="modal-title"><i class="fas fa-receipt"></i> Payment Receipt</h3>
                <button class="close-modal" id="close-receipt">&times;</button>
            </div>
            <div class="modal-body">
                <div id="receipt-content" style="font-family: 'Courier New', monospace; padding: 20px;">
                    <!-- Receipt content will be generated here -->
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" id="print-receipt-btn">
                        <i class="fas fa-print"></i> Print Receipt
                    </button>
                    <button class="btn btn-success" id="watch-movie-btn" style="margin-left: 10px;">
                        <i class="fas fa-play"></i> Watch Movie Now
                    </button>
                    <button class="btn btn-info" id="go-to-downloads-btn" style="margin-left: 10px;">
                        <i class="fas fa-download"></i> Go to Downloads
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Platform (For Regular Users) -->
    <section id="main-platform">
        <!-- Navigation with Hamburger Menu -->
        <nav class="navbar">
            <div class="nav-brand">
                <span class="brand-primary">B/F</span> Cinema
            </div>
            
            <!-- Hamburger Menu -->
            <div class="hamburger-menu">
                <button class="menu-toggle" id="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="menu-dropdown" id="menu-dropdown">
                    <div class="menu-header">
                        <h3 id="menu-user-name">User Name</h3>
                        <p id="menu-user-email">user@example.com</p>
                    </div>
                    
                    <div class="menu-items">
                        <a class="menu-item active" data-section="movies">
                            <i class="fas fa-film"></i>
                            <span>Movies</span>
                        </a>
                        <a class="menu-item" data-section="downloads">
                            <i class="fas fa-download"></i>
                            <span>My Downloads</span>
                        </a>
                        <a class="menu-item" data-section="profile">
                            <i class="fas fa-user"></i>
                            <span>User Profile</span>
                        </a>
                        
                        <!-- Theme Toggle -->
                        <div class="theme-toggle">
                            <div class="theme-label">
                                <i class="fas fa-palette"></i>
                                <span>Theme</span>
                            </div>
                            <label class="theme-switch">
                                <input type="checkbox" id="theme-toggle">
                                <span class="theme-slider"></span>
                            </label>
                        </div>
                        
                        <!-- Logout -->
                        <a class="menu-item" id="menu-logout">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content - Only one section visible at a time -->
        <main class="main-content">
            <!-- Movies Section (Visible by default after login) -->
            <section id="movies-section">
                <div class="hero">
                    <div class="container">
                        <h1>Welcome to B/F Cinema</h1>
                        <p>Your ultimate destination for streaming premium movies. All videos are securely stored on Wasabi Cloud Storage.</p>
                    </div>
                </div>
                
                <div class="container">
                    <h2 class="section-title">Available Movies</h2>
                    <div class="movies-grid" id="movies-container">
                        <!-- Movies loaded by JavaScript -->
                    </div>
                    
                    <!-- Empty state for no movies -->
                    <div id="no-movies" style="text-align: center; padding: 60px 20px; display: none;">
                        <i class="fas fa-film" style="font-size: 4rem; color: var(--text-gray); margin-bottom: 20px;"></i>
                        <h3 style="color: var(--text-gray); margin-bottom: 10px;">No Movies Available</h3>
                        <p style="color: var(--text-gray);">Admin hasn't uploaded any movies yet. Please check back later.</p>
                    </div>
                </div>
            </section>

            <!-- Downloads Section (Hidden by default) -->
            <section id="downloads-section">
                <div class="container downloads-container">
                    <h2 class="section-title">My Downloads</h2>
                    <div class="downloads-grid" id="downloads-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                        <!-- Downloads loaded by JavaScript -->
                    </div>
                    <div id="no-downloads" style="text-align: center; padding: 60px 20px;">
                        <i class="fas fa-download" style="font-size: 4rem; color: var(--text-gray); margin-bottom: 20px;"></i>
                        <h3 style="color: var(--text-gray); margin-bottom: 10px;">No Downloads Yet</h3>
                        <p style="color: var(--text-gray);">Movies you download will appear here</p>
                    </div>
                </div>
            </section>

            <!-- Profile Section (Hidden by default) -->
            <section id="profile-section">
                <div class="container profile-container">
                    <div class="profile-header" style="display: flex; align-items: center; gap: 30px; margin-bottom: 40px;">
                        <div class="profile-avatar" id="profile-avatar" style="width: 100px; height: 100px; background: linear-gradient(135deg, #e50914, #b20710); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: bold; color: white;">U</div>
                        <div class="profile-info">
                            <h2 id="profile-name" style="font-size: 2rem; margin-bottom: 10px;">User Name</h2>
                            <p id="profile-email" style="color: var(--text-gray); margin-bottom: 5px;">user@example.com</p>
                            <p id="profile-phone" style="color: var(--text-gray); margin-bottom: 5px;">+254 700 505325</p>
                            <p style="color: var(--text-gray);">Member since: <span id="member-since" style="font-weight: bold;">2026</span></p>
                        </div>
                    </div>
                    
                    <div class="profile-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
                        <div class="stat-card">
                            <div class="stat-number" id="movies-watched" style="font-size: 2.5rem; font-weight: bold; color: var(--primary);">0</div>
                            <div class="stat-label" style="color: var(--text-gray);">Movies Watched</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="downloads-count" style="font-size: 2.5rem; font-weight: bold; color: var(--primary);">0</div>
                            <div class="stat-label" style="color: var(--text-gray);">Downloads</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="account-age" style="font-size: 2.5rem; font-weight: bold; color: var(--primary);">0</div>
                            <div class="stat-label" style="color: var(--text-gray);">Days Active</div>
                        </div>
                    </div>
                    
                    <!-- Change Password Form -->
                    <div class="password-form" style="max-width: 500px;">
                        <h3 style="margin-bottom: 20px;">Change Password</h3>
                        <form id="change-password-form">
                            <div class="form-group">
                                <label class="form-label" for="current-password">Current Password</label>
                                <input type="password" class="form-control" id="current-password" placeholder="Enter current password" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="new-password">New Password</label>
                                <input type="password" class="form-control" id="new-password" placeholder="Enter new password (min. 8 characters)" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="confirm-new-password">Confirm New Password</label>
                                <input type="password" class="form-control" id="confirm-new-password" placeholder="Confirm new password" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-key"></i> Change Password
                            </button>
                        </form>
                    </div>
                </div>
            </section>
        </main>

        <!-- Main Platform Footer -->
        <footer class="main-footer">
            <div class="container">
                <div class="main-footer-content">
                    <div class="footer-column">
                        <h3>B/F Cinema</h3>
                        <p>Your ultimate destination for streaming premium movies. Powered by Wasabi Cloud Storage.</p>
                    </div>
                    <div class="footer-column">
                        <h3>Quick Links</h3>
                        <ul class="footer-links">
                            <li><a href="#" class="menu-item" data-section="movies">Movies</a></li>
                            <li><a href="#" class="menu-item" data-section="downloads">Downloads</a></li>
                            <li><a href="#" class="menu-item" data-section="profile">Profile</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h3>Security</h3>
                        <ul class="footer-links">
                            <li>Wasabi Cloud Storage</li>
                            <li>Admin Content Only</li>
                            <li>Secure Streaming</li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h3>Contact Support</h3>
                        <ul class="footer-links">
                            <li><a href="mailto:bfCinemamovies@gmail.com">bfCinemamovies@gmail.com</a></li>
                            <li><a href="tel:+254700505325">+254 700 505325</a></li>
                            <li>24/7 Customer Support</li>
                        </ul>
                    </div>
                </div>
                <div class="copyright">
                    &copy; 2026 B/F Cinema. All rights reserved. Powered by Wasabi Cloud Storage.
                </div>
            </div>
        </footer>
    </section>

    <!-- Admin Panel -->
    <section id="admin-panel">
        <!-- Admin Sidebar Navigation -->
        <aside class="admin-sidebar" id="admin-sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand">
                    <i class="fas fa-crown"></i>
                    <span>B/F CINEMA ADMIN</span>
                </div>
                <p class="admin-email" id="admin-email">BFCM2026@GMAIL.COM</p>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="movie-management">
                        <i class="fas fa-film"></i>
                        <span>Movie Management</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="uploads">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>Uploads</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="users">
                        <i class="fas fa-users"></i>
                        <span>Users</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="storage">
                        <i class="fas fa-database"></i>
                        <span>Storage</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="finance">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Finance & Transactions</span>
                    </a>
                </li>
            </ul>
            
            <div class="sidebar-footer">
                <div class="theme-toggle">
                    <i class="fas fa-moon"></i>
                    <label class="theme-switch">
                        <input type="checkbox" id="admin-theme-toggle">
                        <span class="theme-slider"></span>
                    </label>
                    <i class="fas fa-sun"></i>
                </div>
                <button class="btn btn-secondary" id="admin-logout-btn" style="width: 100%; margin-top: 15px;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </aside>

        <!-- Admin Main Content -->
        <main class="admin-main" id="admin-main">
            <!-- Top Header -->
            <header class="admin-header">
                <div class="header-left" style="display: flex; align-items: center; gap: 15px;">
                    <button class="admin-menu-toggle" id="admin-menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="current-section-title">Dashboard</h1>
                </div>
                <div class="admin-header-actions">
                    <button class="btn btn-primary" id="refresh-admin-data">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn btn-info" id="back-to-main">
                        <i class="fas fa-external-link-alt"></i> Switch to User View
                    </button>
                    <span id="current-date" style="color: var(--text-gray); font-size: 0.9rem;"></span>
                </div>
            </header>

            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-content">
                            <h3 id="total-movies-admin">0</h3>
                            <p>Total Movies</p>
                            <small><i class="fas fa-cloud"></i> Stored on Wasabi</small>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-content">
                            <h3 id="total-users-admin">0</h3>
                            <p>Registered Users</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-content">
                            <h3 id="total-downloads-admin">0</h3>
                            <p>Total Downloads</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-content">
                            <h3 id="storage-used-admin">0 GB</h3>
                            <p>Storage Used</p>
                        </div>
                    </div>
                </div>
                
                <!-- Wasabi Storage Info -->
                <div class="wasabi-info">
                    <h4><i class="fas fa-cloud"></i> Wasabi Cloud Storage</h4>
                    <p><strong>Bucket:</strong> bfcinema</p>
                    <p><strong>Region:</strong> eu-central-2 (Frankfurt)</p>
                    <p><strong>Flask Server Endpoint:</strong> <span id="current-server-endpoint">Loading...</span></p>
                    <p><strong>Status:</strong> <span id="storage-status">Active</span></p>
                    <button class="btn btn-info" onclick="testWasabiConnection()">
                        <i class="fas fa-plug"></i> Test Connection
                    </button>
                </div>
                
                <h2 class="section-title">Recent Activity</h2>
                <div class="table-responsive">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Action</th>
                                <th>User</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="activity-table">
                            <tr><td colspan="4" style="text-align: center; padding: 20px; color: var(--text-gray);">No recent activity</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Movie Management Section -->
            <section id="movie-management-section" class="content-section">
                <h2 class="section-title">Movie Management</h2>
                <p class="admin-subtitle" style="color: var(--text-gray); margin-bottom: 30px;">Edit or delete movies stored on Wasabi</p>
                
                <div class="table-responsive">
                    <table class="admin-table" id="admin-movies-table">
                        <thead>
                            <tr>
                                <th>Poster</th>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Year</th>
                                <th>Views</th>
                                <th>Downloads</th>
                                <th>Storage</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="admin-movies-table-body">
                            <!-- Movies will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- UPDATED: Uploads Section with Queue System -->
            <section id="uploads-section" class="content-section">
                <h2 class="section-title">Upload Movie to Wasabi S3</h2>
                <p class="admin-subtitle" style="color: var(--text-gray); margin-bottom: 30px;">Upload movies directly to Wasabi Cloud Storage with poster image</p>
                
                <div class="wasabi-info">
                    <h4><i class="fas fa-info-circle"></i> Upload Information</h4>
                    <p>Upload both movie file and poster image directly to Wasabi S3 storage via Flask server</p>
                    <p><strong>Flask Server:</strong> <span id="current-upload-endpoint">Loading...</span></p>
                    <p><strong>Supported Video Formats:</strong> MP4, AVI, MOV, MKV, etc.</p>
                    <p><strong>Supported Image Formats:</strong> JPEG, PNG, GIF, WebP, etc.</p>
                </div>
                
                <div class="upload-container">
                    <div class="admin-card">
                        <form id="upload-movie-form" class="admin-form" enctype="multipart/form-data">
                            <div class="form-group">
                                <label class="form-label" for="admin-movie-title">Movie Title *</label>
                                <input type="text" class="form-input" id="admin-movie-title" placeholder="Enter movie title" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="admin-movie-description">Description *</label>
                                <textarea class="form-input" id="admin-movie-description" placeholder="Enter movie description" rows="3" required></textarea>
                            </div>
                            
                            <!-- Poster Image Upload -->
                            <div class="form-group">
                                <label class="form-label">Movie Poster (Image) *</label>
                                <div class="drag-drop-area" id="admin-poster-drop-area">
                                    <i class="fas fa-image"></i>
                                    <p>Drag & drop poster image here</p>
                                    <p><small>or click to select file (JPEG, PNG, GIF, etc.)</small></p>
                                    <input type="file" id="admin-poster-file" accept="image/*" style="display: none;">
                                </div>
                                <div class="file-info" id="admin-poster-info"></div>
                                
                                <div style="margin-top: 10px; text-align: center;">
                                    <button type="button" class="btn btn-secondary" id="select-poster-btn" style="width: 200px;">
                                        <i class="fas fa-image"></i> Select Poster Image
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Movie File Upload -->
                            <div class="form-group">
                                <label class="form-label">Movie File (Video) *</label>
                                <div class="drag-drop-area" id="admin-video-drop-area">
                                    <i class="fas fa-video"></i>
                                    <p>Drag & drop video file here</p>
                                    <p><small>or click to select file (MP4, AVI, MOV, MKV, etc.)</small></p>
                                    <input type="file" id="admin-video-file" accept="video/*" style="display: none;">
                                </div>
                                <div class="file-info" id="admin-video-info"></div>
                                
                                <div style="margin-top: 10px; text-align: center;">
                                    <button type="button" class="btn btn-primary" id="select-movie-btn" style="width: 200px;">
                                        <i class="fas fa-film"></i> Select Movie File
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="admin-movie-year">Release Year</label>
                                <input type="number" class="form-input" id="admin-movie-year" placeholder="e.g., 2024" min="1900" max="2026">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="admin-movie-duration">Duration (minutes)</label>
                                <input type="number" class="form-input" id="admin-movie-duration" placeholder="e.g., 120">
                            </div>
                            
                            <button type="submit" class="btn btn-primary" style="width: 200px; margin-top: 20px;">
                                <i class="fas fa-upload"></i> Upload Movie
                            </button>
                        </form>
                    </div>
                    
                    <!-- UPDATED: Enhanced Upload Progress Container -->
                    <div class="upload-progress-container" style="margin-top: 20px; display: none;" id="upload-progress-container">
                        <h4><i class="fas fa-upload"></i> Upload Progress</h4>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span id="upload-file-name">File: None</span>
                            <span id="upload-file-size">Size: 0 MB</span>
                        </div>
                        <div class="progress-container" style="margin: 10px 0;">
                            <div class="progress-bar" id="upload-progress-bar" style="width: 0%;"></div>
                        </div>
                        <div class="upload-status" id="upload-status-details" style="background: rgba(229, 9, 20, 0.1); padding: 15px; border-radius: 8px; margin-top: 10px;">
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                                <div>
                                    <strong>Status:</strong><br>
                                    <span id="upload-status-text" style="color: var(--primary); font-weight: bold;">Initializing...</span>
                                </div>
                                <div>
                                    <strong>Speed:</strong><br>
                                    <span id="upload-speed">0 MB/s</span>
                                </div>
                                <div>
                                    <strong>Time Elapsed:</strong><br>
                                    <span id="upload-time">0s</span>
                                </div>
                            </div>
                            <div style="margin-top: 10px; display: flex; justify-content: space-between;">
                                <span><strong>Percentage:</strong> <span id="upload-percentage">0%</span></span>
                                <span><strong>Remaining:</strong> <span id="upload-remaining">--</span></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- NEW: Upload Queue -->
                    <div class="upload-queue" id="upload-queue" style="margin-top: 30px;">
                        <h4>Upload Queue</h4>
                        <div id="upload-queue-items">
                            <p>No uploads in queue</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Users Section -->
            <section id="users-section" class="content-section">
                <h2 class="section-title">User Management</h2>
                <p class="admin-subtitle" style="color: var(--text-gray); margin-bottom: 30px;">View and manage all registered users</p>
                
                <div class="table-responsive">
                    <table class="admin-table" id="users-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Joined</th>
                                <th>Downloads</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Storage Section -->
            <section id="storage-section" class="content-section">
                <h2 class="section-title">Wasabi Storage</h2>
                <p class="admin-subtitle" style="color: var(--text-gray); margin-bottom: 30px;">Manage cloud storage and settings</p>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-content">
                            <h3 id="movies-count-admin">0</h3>
                            <p>Movies on Wasabi</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-content">
                            <h3 id="storage-total-admin">1 TB</h3>
                            <p>Total Storage</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-content">
                            <h3 id="storage-free-admin">1 TB</h3>
                            <p>Available Storage</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-content">
                            <h3 id="storage-cost-admin">$0</h3>
                            <p>Monthly Cost</p>
                        </div>
                    </div>
                </div>
                
                <div class="wasabi-info">
                    <h4><i class="fas fa-cog"></i> Wasabi Configuration</h4>
                    <p><strong>Access Key:</strong> NLXDDRMUWSYD2PW7IY8S</p>
                    <p><strong>Secret Key:</strong> ********************</p>
                    <p><strong>Bucket:</strong> bfcinema</p>
                    <p><strong>Region:</strong> eu-central-2</p>
                    <p><strong>Endpoint:</strong> https://s3.eu-central-2.wasabisys.com</p>
                    <p><strong>Current Server:</strong> <span id="storage-server-endpoint">Loading...</span></p>
                </div>
            </section>

            <!-- NEW: Finance Section -->
            <section id="finance-section" class="content-section">
                <h2 class="section-title">Finance & Transactions</h2>
                <p class="admin-subtitle" style="color: var(--text-gray); margin-bottom: 30px;">View all MPesa transactions and manage users</p>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-content">
                            <h3 id="total-transactions">0</h3>
                            <p>Total Transactions</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-content">
                            <h3 id="total-revenue">KES 0</h3>
                            <p>Total Revenue</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-content">
                            <h3 id="verified-transactions">0</h3>
                            <p>Verified Payments</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-content">
                            <h3 id="fraudulent-transactions">0</h3>
                            <p>Fraudulent Attempts</p>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="admin-table" id="transactions-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User</th>
                                <th>Movie</th>
                                <th>Transaction Code</th>
                                <th>MPesa Message</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-table-body">
                            <!-- Transactions will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </section>

    <!-- UPDATED: Enhanced Video Player with HTML5 fallback -->
    <div class="video-player-container" id="video-player">
        <div class="video-player">
            <button class="close-player" id="close-player">&times;</button>
            
            <!-- Enhanced video element with multiple sources -->
            <video class="video-element" id="video-element" controls controlsList="nodownload" 
                   preload="metadata" crossorigin="anonymous" playsinline>
                <p>Your browser doesn't support HTML5 video. Here is a 
                   <a href="#" id="direct-download-link">link to download the video</a> instead.</p>
            </video>
            
            <!-- Video controls overlay -->
            <div id="video-controls-overlay" style="position: absolute; bottom: 0; left: 0; right: 0; 
                 background: linear-gradient(transparent, rgba(0,0,0,0.7)); padding: 20px; color: white;">
                <h3 id="player-title">Movie Title</h3>
                <p id="player-description">Movie description</p>
                <div style="margin-top: 10px;">
                    <button id="retry-playback" class="btn btn-primary btn-sm">
                        <i class="fas fa-redo"></i> Retry Playback
                    </button>
                    <button id="try-different-format" class="btn btn-secondary btn-sm" style="margin-left: 10px;">
                        <i class="fas fa-sync"></i> Try Different Format
                    </button>
                </div>
            </div>
            
            <div style="padding: 20px; background: #111; color: white;">
                <p><small>Streaming from Wasabi Cloud Storage</small></p>
                <p id="video-debug-info" style="font-size: 0.8em; color: #999; margin-top: 10px;"></p>
            </div>
        </div>
    </div>

    <!-- Anti-Piracy Warning -->
    <div class="anti-piracy" id="anti-piracy">
        <div>
            <h2><i class="fas fa-exclamation-triangle"></i> SECURITY VIOLATION</h2>
            <p style="font-size: 1.5rem; margin-bottom: 30px;">Screen recording or download attempt detected!</p>
            <p style="margin-bottom: 20px;">Your account has been temporarily suspended for violating our security policy.</p>
            <p>All downloaded content is encrypted and cannot be transferred or recorded.</p>
            <button class="btn btn-primary" style="margin-top: 30px;" id="close-anti-piracy">Acknowledge</button>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <span id="notification-message">Message here</span>
    </div>

    <script>
    // =========== UPDATED: GLOBAL VARIABLES ===========
    // Use current window origin for server endpoint
    const WASABI_ENDPOINT = window.location.origin;
    const WASABI_REGION = 'eu-central-2';
    
    let currentUser = null;
    let isAdmin = false;
    let movies = [];
    let uploadQueue = []; // NEW: Upload queue
    let currentUpload = null; // NEW: Current upload item
    let uploadStartTime = null; // NEW: Upload start time

    // =========== DOM ELEMENTS ===========
    const landingPage = document.getElementById('landing-page');
    const mainPlatform = document.getElementById('main-platform');
    const adminPanel = document.getElementById('admin-panel');
    const loginModal = document.getElementById('login-modal');
    const registerModal = document.getElementById('register-modal');
    const paymentModal = document.getElementById('payment-modal'); // NEW: Payment modal
    const receiptModal = document.getElementById('receipt-modal'); // NEW: Receipt modal
    const videoPlayer = document.getElementById('video-player');
    const antiPiracy = document.getElementById('anti-piracy');
    const notification = document.getElementById('notification');
    const loadingOverlay = document.getElementById('loading-overlay');
    const adminSidebar = document.getElementById('admin-sidebar');
    const adminMain = document.getElementById('admin-main');
    const sidebarOverlay = document.getElementById('sidebar-overlay');

    // =========== INITIALIZATION ===========
    document.addEventListener('DOMContentLoaded', () => {
        console.log('B/F Cinema Platform Initializing...');
        console.log('Server Endpoint:', WASABI_ENDPOINT);
        
        // Update server endpoint displays
        updateServerEndpointDisplays();
        
        // Add global error handlers
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            showNotification(`Error: ${e.message}`, 'error');
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            showNotification(`Promise error: ${e.reason.message || e.reason}`, 'error');
        });
        
        // Check for saved theme preference
        const savedTheme = localStorage.getItem('bfCinemaTheme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-theme');
            const themeToggle = document.getElementById('theme-toggle');
            const adminThemeToggle = document.getElementById('admin-theme-toggle');
            if (themeToggle) themeToggle.checked = true;
            if (adminThemeToggle) adminThemeToggle.checked = true;
        }
        
        // Setup event listeners
        setupEventListeners();
        
        // Setup video playback controls
        setupVideoPlaybackControls();
        
        // Update current date
        updateCurrentDate();
        setInterval(updateCurrentDate, 60000);
        
        // Test server connection
        setTimeout(() => {
            testConnection();
        }, 500);
    });

    // =========== UPDATED: Update server endpoint displays ===========
    function updateServerEndpointDisplays() {
        const endpointElements = [
            'current-server-endpoint',
            'current-upload-endpoint',
            'storage-server-endpoint'
        ];
        
        endpointElements.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = WASABI_ENDPOINT;
            }
        });
    }

    // =========== UPDATED: ENHANCED VIDEO PLAYER FUNCTIONS ===========
    function showVideoPlayer(movie) {
        console.log('Showing video player for movie:', movie);
        console.log('Video URL:', movie.url);
        
        const videoElement = document.getElementById('video-element');
        const playerTitle = document.getElementById('player-title');
        const playerDescription = document.getElementById('player-description');
        
        playerTitle.textContent = movie.title;
        playerDescription.textContent = movie.description || 'No description available';
        
        // Debug the URL
        console.log('Checking movie access...');
        
        checkMovieAccess(movie.id)
            .then(accessData => {
                console.log('Access check result:', accessData);
                
                if (!accessData.has_access && !accessData.is_admin && !movie.free_preview) {
                    console.log('User does not have access, showing payment modal');
                    showPaymentModal(movie.id, movie.title);
                    return;
                }
                
                // Record view on server
                fetch(`${WASABI_ENDPOINT}/api/movies/${movie.id}/watch`, {
                    method: 'POST',
                    credentials: 'include',
                    mode: 'cors'
                }).catch(err => console.error('Failed to record view:', err));
                
                // Set video source
                console.log('Setting video source to:', movie.url);
                videoElement.src = movie.url;
                
                // Set MIME type if known
                if (movie.file_type) {
                    videoElement.type = movie.file_type;
                }
                
                // Add event listeners for debugging
                videoElement.addEventListener('error', function(e) {
                    console.error('Video error:', e);
                    console.error('Video error details:', videoElement.error);
                    console.error('Network state:', videoElement.networkState);
                    console.error('Ready state:', videoElement.readyState);
                    console.error('Current source:', videoElement.currentSrc);
                    
                    // Try alternative playback method
                    tryAlternativePlayback(movie);
                });
                
                videoElement.addEventListener('loadeddata', function() {
                    console.log('Video data loaded');
                    console.log('Video duration:', videoElement.duration);
                    console.log('Video dimensions:', videoElement.videoWidth, 'x', videoElement.videoHeight);
                });
                
                videoElement.addEventListener('loadedmetadata', function() {
                    console.log('Video metadata loaded');
                });
                
                // Load and play the video
                videoElement.load();
                videoPlayer.classList.add('active');
                
                // Try to play automatically with better error handling
                setTimeout(() => {
                    const playPromise = videoElement.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log('Video playback started successfully');
                        }).catch(err => {
                            console.log('Auto-play prevented:', err);
                            // Show play button
                            videoElement.controls = true;
                            showNotification('Click the play button to start watching', 'info');
                        });
                    }
                }, 500);
            })
            .catch(err => {
                console.error('Error checking access:', err);
                showNotification('Error checking movie access: ' + err.message, 'error');
            });
    }

    function tryAlternativePlayback(movie) {
        console.log('Trying alternative playback methods...');
        
        const videoElement = document.getElementById('video-element');
        
        fetch(`${WASABI_ENDPOINT}/api/debug/movie/${movie.id}`, {
            credentials: 'include',
            mode: 'cors'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('Debug info:', data);
                
                if (!data.movie.video_accessible) {
                    showNotification('Movie file is not accessible. Please contact support.', 'error');
                    return;
                }
                
                // Try with different MIME types
                const mimeTypes = [
                    'video/mp4',
                    'video/webm',
                    'video/ogg',
                    'video/x-matroska'
                ];
                
                let tried = false;
                mimeTypes.forEach(mimeType => {
                    if (!tried) {
                        console.log('Trying MIME type:', mimeType);
                        videoElement.type = mimeType;
                        videoElement.load();
                        
                        setTimeout(() => {
                            if (videoElement.error) {
                                console.log(`Failed with ${mimeType}`);
                            } else {
                                console.log(`Success with ${mimeType}`);
                                videoElement.play().catch(e => console.log('Play failed:', e));
                                tried = true;
                            }
                        }, 1000);
                    }
                });
            }
        })
        .catch(err => {
            console.error('Debug fetch error:', err);
            showNotification('Cannot play video. File may be corrupted or unsupported.', 'error');
        });
    }

    function showVideoPlayerStreaming(movie) {
        console.log('Showing video player for movie:', movie);
        
        const videoElement = document.getElementById('video-element');
        const playerTitle = document.getElementById('player-title');
        const playerDescription = document.getElementById('player-description');
        
        playerTitle.textContent = movie.title;
        playerDescription.textContent = movie.description || 'No description available';
        
        checkMovieAccess(movie.id)
            .then(accessData => {
                if (!accessData.has_access && !accessData.is_admin && !movie.free_preview) {
                    showPaymentModal(movie.id, movie.title);
                    return;
                }
                
                // Record view
                fetch(`${WASABI_ENDPOINT}/api/movies/${movie.id}/watch`, {
                    method: 'POST',
                    credentials: 'include',
                    mode: 'cors'
                }).catch(err => console.error('Failed to record view:', err));
                
                // Try streaming URL first, then fallback to direct URL
                const videoSources = [
                    { src: `${WASABI_ENDPOINT}${movie.stream_url}`, type: movie.file_type || 'video/mp4' },
                    { src: movie.url, type: movie.file_type || 'video/mp4' }
                ];
                
                // Clear existing sources
                videoElement.innerHTML = '';
                
                // Add source elements
                videoSources.forEach(source => {
                    const sourceElement = document.createElement('source');
                    sourceElement.src = source.src;
                    sourceElement.type = source.type;
                    videoElement.appendChild(sourceElement);
                });
                
                // Add error message
                const errorMsg = document.createElement('p');
                errorMsg.textContent = 'Your browser does not support the video tag or the video format.';
                errorMsg.style.color = 'white';
                errorMsg.style.padding = '20px';
                videoElement.appendChild(errorMsg);
                
                // Event listeners for debugging
                videoElement.addEventListener('error', function(e) {
                    console.error('Video error:', e);
                    console.error('Error code:', videoElement.error.code);
                    
                    if (videoElement.error.code === 4) {
                        // MEDIA_ERR_SRC_NOT_SUPPORTED
                        showNotification('Video format not supported. Trying alternative...', 'warning');
                        
                        // Try different formats
                        const formats = [
                            { type: 'video/mp4', ext: '.mp4' },
                            { type: 'video/webm', ext: '.webm' },
                            { type: 'video/ogg', ext: '.ogv' }
                        ];
                        
                        formats.forEach(format => {
                            const altSource = document.createElement('source');
                            altSource.src = movie.url.replace(/\.\w+$/, format.ext);
                            altSource.type = format.type;
                            videoElement.appendChild(altSource);
                        });
                        
                        videoElement.load();
                    }
                });
                
                // Load and show player
                videoPlayer.classList.add('active');
                videoElement.load();
                
                // Try to play
                setTimeout(() => {
                    videoElement.play().catch(err => {
                        console.log('Auto-play prevented, showing controls:', err);
                        videoElement.controls = true;
                        showNotification('Click the play button to start watching', 'info');
                    });
                }, 500);
                
            })
            .catch(err => {
                console.error('Access check error:', err);
                showNotification('Error: ' + err.message, 'error');
            });
    }

    function setupVideoPlaybackControls() {
        const retryBtn = document.getElementById('retry-playback');
        const formatBtn = document.getElementById('try-different-format');
        const directDownloadLink = document.getElementById('direct-download-link');
        const debugInfo = document.getElementById('video-debug-info');
        
        if (retryBtn) {
            retryBtn.addEventListener('click', () => {
                const videoElement = document.getElementById('video-element');
                videoElement.load();
                videoElement.play().catch(e => {
                    showNotification('Still unable to play. Try different format.', 'warning');
                });
            });
        }
        
        if (formatBtn) {
            formatBtn.addEventListener('click', () => {
                showNotification('Trying different video formats...', 'info');
            });
        }
        
        if (directDownloadLink) {
            directDownloadLink.addEventListener('click', (e) => {
                e.preventDefault();
                const videoElement = document.getElementById('video-element');
                const currentSrc = videoElement.currentSrc || videoElement.src;
                if (currentSrc) {
                    window.open(currentSrc, '_blank');
                }
            });
        }
    }

    function hideVideoPlayer() {
        const videoElement = document.getElementById('video-element');
        videoElement.pause();
        videoElement.src = '';
        videoElement.innerHTML = ''; // Clear sources
        videoPlayer.classList.remove('active');
    }

    // =========== UPDATED: SERVER CONNECTION TEST ===========
    async function testConnection() {
        console.log('Testing connection to server...');
        showLoading(true);
        
        // Use current origin
        const serverUrl = window.location.origin;
        
        try {
            const response = await fetch(`${serverUrl}/health`, {
                method: 'GET',
                mode: 'cors',
                credentials: 'include'
            });
            
            if (response.ok) {
                const data = await response.json();
                console.log(` Server connected:`, data);
                window.WASABI_ENDPOINT = serverUrl;
                await checkSavedSession();
            } else {
                throw new Error('Server not responding');
            }
            
        } catch (err) {
            console.error('Cannot connect to server:', err);
            showNotification(' Cannot connect to server. Please refresh the page.', 'error');
            setTimeout(() => {
                landingPage.classList.remove('hidden');
                showLoading(false);
            }, 1000);
        }
    }

    // =========== CHECK SAVED SESSION ===========
    async function checkSavedSession() {
        try {
            console.log('Checking saved session...');
            const response = await fetch(`${WASABI_ENDPOINT}/api/check-auth`, {
                method: 'GET',
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            console.log('Session check response:', data);
            
            if (data.authenticated) {
                currentUser = data.user;
                console.log('User authenticated:', currentUser);
                
                if (data.user.isAdmin) {
                    isAdmin = true;
                    showAdminPanel();
                    showNotification('Welcome back, Administrator!', 'success');
                } else {
                    showMainPlatform();
                    showNotification('Welcome back!', 'success');
                }
            } else {
                // No saved session, show landing page
                console.log('No saved session, showing landing page');
                setTimeout(() => {
                    landingPage.classList.remove('hidden');
                    showLoading(false);
                }, 1000);
            }
        } catch (err) {
            console.error('Session check failed:', err);
            setTimeout(() => {
                landingPage.classList.remove('hidden');
                showLoading(false);
            }, 1000);
        }
    }

    // =========== EVENT LISTENERS ===========
    function setupEventListeners() {
        console.log('Setting up event listeners...');
        
        // Auth buttons
        document.getElementById('login-intro-btn').addEventListener('click', () => showModal(loginModal));
        document.getElementById('register-intro-btn').addEventListener('click', () => showModal(registerModal));
        document.getElementById('close-login').addEventListener('click', () => hideModal(loginModal));
        document.getElementById('close-register').addEventListener('click', () => hideModal(registerModal));
        document.getElementById('close-payment').addEventListener('click', () => hideModal(paymentModal));
        document.getElementById('close-receipt').addEventListener('click', () => hideModal(receiptModal));
        
        // Form submissions
        document.getElementById('login-form').addEventListener('submit', handleUserLogin);
        document.getElementById('register-form').addEventListener('submit', handleUserRegister);
        document.getElementById('payment-form').addEventListener('submit', handlePayment);
        document.getElementById('change-password-form')?.addEventListener('submit', handleChangePassword);
        
        // Modal switching
        document.getElementById('switch-to-register').addEventListener('click', (e) => {
            e.preventDefault();
            hideModal(loginModal);
            showModal(registerModal);
        });
        
        document.getElementById('switch-to-login').addEventListener('click', (e) => {
            e.preventDefault();
            hideModal(registerModal);
            showModal(loginModal);
        });
        
        // Navigation
        const menuToggle = document.getElementById('menu-toggle');
        if (menuToggle) {
            menuToggle.addEventListener('click', toggleMenu);
        }
        
        // Menu item clicks for user navigation
        document.querySelectorAll('.menu-item[data-section]').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const section = item.dataset.section;
                showOnlySection(section);
                
                document.querySelectorAll('.menu-item[data-section]').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                
                if (window.innerWidth <= 768) {
                    const menuDropdown = document.getElementById('menu-dropdown');
                    if (menuDropdown) menuDropdown.classList.remove('active');
                }
            });
        });
        
        // Admin navigation
        document.querySelectorAll('.nav-link[data-section]').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const section = item.dataset.section;
                showAdminSection(section);
                
                document.querySelectorAll('.nav-link[data-section]').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
            });
        });
        
        // Theme toggles
        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            themeToggle.addEventListener('change', toggleTheme);
        }
        
        const adminThemeToggle = document.getElementById('admin-theme-toggle');
        if (adminThemeToggle) {
            adminThemeToggle.addEventListener('change', toggleTheme);
        }
        
        // Logout buttons
        const menuLogout = document.getElementById('menu-logout');
        if (menuLogout) {
            menuLogout.addEventListener('click', (e) => {
                e.preventDefault();
                handleLogout();
            });
        }
        
        const adminLogoutBtn = document.getElementById('admin-logout-btn');
        if (adminLogoutBtn) {
            adminLogoutBtn.addEventListener('click', handleLogout);
        }
        
        // Back to platform from admin
        const backToMainBtn = document.getElementById('back-to-main');
        if (backToMainBtn) {
            backToMainBtn.addEventListener('click', () => {
                if (confirm('Switch to user view?')) {
                    showMainPlatform();
                }
            });
        }
        
        // Video player
        document.getElementById('close-player').addEventListener('click', hideVideoPlayer);
        
        // Anti-piracy
        document.getElementById('close-anti-piracy').addEventListener('click', () => {
            antiPiracy.classList.remove('active');
            handleLogout();
        });
        
        // Forgot password
        const forgotPassword = document.getElementById('forgot-password');
        if (forgotPassword) {
            forgotPassword.addEventListener('click', (e) => {
                e.preventDefault();
                showNotification('Contact admin to reset password: BFCM2026@GMAIL.COM', 'info');
            });
        }
        
        // Refresh admin data
        const refreshAdminBtn = document.getElementById('refresh-admin-data');
        if (refreshAdminBtn) {
            refreshAdminBtn.addEventListener('click', refreshAdminData);
        }
        
        // Admin menu toggle
        const adminMenuToggle = document.getElementById('admin-menu-toggle');
        if (adminMenuToggle) {
            adminMenuToggle.addEventListener('click', toggleAdminSidebar);
        }
        
        // Setup file upload handlers
        setupFileUploadHandlers();
        
        // Payment step buttons
        const nextStepBtn = document.getElementById('next-step-btn');
        if (nextStepBtn) {
            nextStepBtn.addEventListener('click', function() {
                document.getElementById('step-1-content').style.display = 'none';
                document.getElementById('step-2-content').style.display = 'block';
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.remove('active');
                });
                document.querySelector('.step[data-step="2"]').classList.add('active');
                document.querySelector('.step[data-step="1"] .step-circle').style.background = '#2ecc71';
                document.querySelector('.step[data-step="2"] .step-circle').style.background = 'var(--primary)';
            });
        }
        
        const prevStepBtn = document.getElementById('prev-step-btn');
        if (prevStepBtn) {
            prevStepBtn.addEventListener('click', function() {
                document.getElementById('step-2-content').style.display = 'none';
                document.getElementById('step-1-content').style.display = 'block';
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.remove('active');
                });
                document.querySelector('.step[data-step="1"]').classList.add('active');
                document.querySelector('.step[data-step="1"] .step-circle').style.background = 'var(--primary)';
                document.querySelector('.step[data-step="2"] .step-circle').style.background = 'var(--text-gray)';
            });
        }
        
        // Close modals when clicking outside
        document.addEventListener('click', (e) => {
            if (e.target === loginModal) hideModal(loginModal);
            if (e.target === registerModal) hideModal(registerModal);
            if (e.target === paymentModal) hideModal(paymentModal);
            if (e.target === receiptModal) hideModal(receiptModal);
            if (e.target === videoPlayer) hideVideoPlayer();
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                hideModal(loginModal);
                hideModal(registerModal);
                hideModal(paymentModal);
                hideModal(receiptModal);
                hideVideoPlayer();
                if (antiPiracy.classList.contains('active')) {
                    antiPiracy.classList.remove('active');
                    handleLogout();
                }
            }
        });
        
        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
            const sidebar = document.getElementById('admin-sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const menuToggle = document.getElementById('admin-menu-toggle');
            
            if (sidebar && sidebar.classList.contains('active') && 
                window.innerWidth <= 992 && 
                !sidebar.contains(e.target) && 
                !(menuToggle && (menuToggle === e.target || menuToggle.contains(e.target)))) {
                toggleAdminSidebar();
            }
        });
        
        console.log('Event listeners setup complete');
    }

    // =========== FILE UPLOAD HANDLERS ===========
    function setupFileUploadHandlers() {
        console.log('Setting up file upload handlers...');
        
        // Poster image upload
        const adminPosterDropArea = document.getElementById('admin-poster-drop-area');
        const adminPosterFile = document.getElementById('admin-poster-file');
        const selectPosterBtn = document.getElementById('select-poster-btn');
        
        if (adminPosterDropArea && adminPosterFile) {
            setupDragAndDrop(adminPosterDropArea, adminPosterFile, 'admin-poster-info');
        }
        
        if (selectPosterBtn && adminPosterFile) {
            selectPosterBtn.addEventListener('click', () => {
                adminPosterFile.click();
            });
        }
        
        if (adminPosterFile) {
            adminPosterFile.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const infoEl = document.getElementById('admin-poster-info');
                    if (infoEl) {
                        infoEl.innerHTML = `
                            <strong>Selected Poster:</strong> ${file.name}<br>
                            <small>Size: ${(file.size / 1024 / 1024).toFixed(2)} MB | Type: ${file.type}</small>
                        `;
                        infoEl.style.display = 'block';
                    }
                }
            });
        }
        
        // Movie video upload
        const adminVideoDropArea = document.getElementById('admin-video-drop-area');
        const adminVideoFile = document.getElementById('admin-video-file');
        const selectMovieBtn = document.getElementById('select-movie-btn');
        
        if (adminVideoDropArea && adminVideoFile) {
            setupDragAndDrop(adminVideoDropArea, adminVideoFile, 'admin-video-info');
        }
        
        if (selectMovieBtn && adminVideoFile) {
            selectMovieBtn.addEventListener('click', () => {
                adminVideoFile.click();
            });
        }
        
        if (adminVideoFile) {
            adminVideoFile.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const infoEl = document.getElementById('admin-video-info');
                    if (infoEl) {
                        infoEl.innerHTML = `
                            <strong>Selected Movie:</strong> ${file.name}<br>
                            <small>Size: ${(file.size / 1024 / 1024).toFixed(2)} MB | Type: ${file.type}</small>
                        `;
                        infoEl.style.display = 'block';
                    }
                }
            });
        }
        
        // Movie upload form - UPDATED with new handler
        const uploadMovieForm = document.getElementById('upload-movie-form');
        if (uploadMovieForm) {
            uploadMovieForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const title = document.getElementById('admin-movie-title').value;
                const description = document.getElementById('admin-movie-description').value;
                const year = document.getElementById('admin-movie-year').value;
                const duration = document.getElementById('admin-movie-duration').value;
                const posterFile = document.getElementById('admin-poster-file').files[0];
                const videoFile = document.getElementById('admin-video-file').files[0];
                
                // Validation
                if (!title) {
                    showNotification('Title is required', 'error');
                    return;
                }
                
                if (!posterFile) {
                    showNotification('Poster image is required', 'error');
                    return;
                }
                
                if (!videoFile) {
                    showNotification('Movie file is required', 'error');
                    return;
                }
                
                // Add to upload queue
                addToUploadQueue(posterFile, videoFile, title, description, year, duration);
                
                // Reset form
                e.target.reset();
                document.getElementById('admin-poster-info').style.display = 'none';
                document.getElementById('admin-video-info').style.display = 'none';
                
                showNotification('Movie added to upload queue', 'success');
            });
        }
        
        console.log('File upload handlers setup complete');
    }

    function setupDragAndDrop(dropArea, fileInput, infoId) {
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });
        
        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });
        
        dropArea.addEventListener('drop', handleDrop, false);
        dropArea.addEventListener('click', () => fileInput.click());
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        function highlight() {
            dropArea.style.borderColor = 'var(--primary-dark)';
            dropArea.style.backgroundColor = 'rgba(229, 9, 20, 0.1)';
        }
        
        function unhighlight() {
            dropArea.style.borderColor = '';
            dropArea.style.backgroundColor = '';
        }
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0) {
                fileInput.files = files;
                const event = new Event('change');
                fileInput.dispatchEvent(event);
            }
        }
    }

    // =========== SIMPLE UPLOAD FUNCTION ===========
    async function uploadFile(file, fileType) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('fileType', fileType);
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/upload-file`, {
                method: 'POST',
                body: formData,
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            return data;
        } catch (error) {
            throw error;
        }
    }

    // =========== COMPLETE MOVIE UPLOAD ===========
    async function completeMovieUpload(uploadItem) {
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/upload-movie-complete`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    title: uploadItem.title,
                    description: uploadItem.description,
                    year: uploadItem.year,
                    duration: uploadItem.duration,
                    video_filename: uploadItem.videoFilename,
                    poster_filename: uploadItem.posterFilename
                }),
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            return data;
        } catch (error) {
            throw error;
        }
    }

    // =========== UPDATED PROCESS NEXT UPLOAD ===========
    async function processNextUpload() {
        if (uploadQueue.length === 0 || currentUpload) {
            return;
        }
        
        currentUpload = uploadQueue[0];
        currentUpload.status = 'uploading';
        uploadStartTime = Date.now();
        
        // Show progress container
        const progressContainer = document.getElementById('upload-progress-container');
        const progressBar = document.getElementById('upload-progress-bar');
        const statusText = document.getElementById('upload-status-text');
        const speedText = document.getElementById('upload-speed');
        const timeText = document.getElementById('upload-time');
        const percentageText = document.getElementById('upload-percentage');
        
        if (progressContainer) progressContainer.style.display = 'block';
        if (statusText) statusText.textContent = 'Starting upload...';
        if (percentageText) percentageText.textContent = '0%';
        
        try {
            // Upload poster
            if (statusText) statusText.textContent = 'Uploading poster...';
            const posterResult = await uploadFile(currentUpload.posterFile, 'poster');
            currentUpload.posterFilename = posterResult.filename;
            currentUpload.progress = 30;
            updateUploadProgress();
            
            // Upload video with progress tracking
            if (statusText) statusText.textContent = 'Uploading video...';
            
            // Create FormData for video
            const videoFormData = new FormData();
            videoFormData.append('file', currentUpload.videoFile);
            videoFormData.append('fileType', 'movie');
            
            // Use XMLHttpRequest for progress tracking
            const videoResult = await uploadFileWithProgress(
                currentUpload.videoFile, 
                'movie',
                (progress) => {
                    currentUpload.progress = 30 + (progress * 0.7);
                    updateUploadProgress();
                }
            );
            
            currentUpload.videoFilename = videoResult.filename;
            currentUpload.progress = 100;
            updateUploadProgress();
            
            // Complete the upload
            if (statusText) statusText.textContent = 'Finalizing...';
            const completeResult = await completeMovieUpload(currentUpload);
            
            if (completeResult.success) {
                currentUpload.status = 'completed';
                if (statusText) statusText.textContent = 'Upload completed!';
                showNotification(`Movie "${currentUpload.title}" uploaded successfully!`, 'success');
                
                // Refresh admin movies list
                if (isAdmin) {
                    loadAdminMovies();
                    refreshAdminData();
                }
            } else {
                throw new Error(completeResult.error);
            }
            
        } catch (error) {
            console.error('Upload failed:', error);
            currentUpload.status = 'failed';
            if (statusText) {
                statusText.textContent = `Failed: ${error.message}`;
                statusText.style.color = 'var(--danger)';
            }
            showNotification(`Upload failed: ${error.message}`, 'error');
        } finally {
            // Remove from queue after a delay
            setTimeout(() => {
                uploadQueue.shift();
                currentUpload = null;
                
                // Process next upload
                processNextUpload();
                updateUploadQueueDisplay();
                
                // Hide progress container if queue is empty
                if (uploadQueue.length === 0 && progressContainer) {
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                        progressBar.style.width = '0%';
                        if (statusText) {
                            statusText.textContent = 'Initializing...';
                            statusText.style.color = '';
                        }
                    }, 2000);
                }
            }, 2000);
        }
    }

    // =========== UPLOAD FILE WITH PROGRESS ===========
    function uploadFileWithProgress(file, fileType, onProgress) {
        return new Promise((resolve, reject) => {
            const xhr = new XMLHttpRequest();
            const formData = new FormData();
            
            formData.append('file', file);
            formData.append('fileType', fileType);
            
            xhr.open('POST', `${WASABI_ENDPOINT}/api/upload-file`);
            xhr.withCredentials = true;
            
            xhr.upload.addEventListener('progress', (event) => {
                if (event.lengthComputable) {
                    const percentComplete = (event.loaded / event.total) * 100;
                    if (onProgress) onProgress(percentComplete);
                }
            });
            
            xhr.addEventListener('load', () => {
                if (xhr.status === 200) {
                    try {
                        const response = JSON.parse(xhr.responseText);
                        if (response.success) {
                            resolve(response);
                        } else {
                            reject(new Error(response.error || 'Upload failed'));
                        }
                    } catch (error) {
                        reject(new Error('Invalid response from server'));
                    }
                } else {
                    reject(new Error(`Upload failed with status ${xhr.status}`));
                }
            });
            
            xhr.addEventListener('error', () => {
                reject(new Error('Network error during upload'));
            });
            
            xhr.send(formData);
        });
    }

    // =========== UPDATE UPLOAD PROGRESS DISPLAY ===========
    function updateUploadProgress() {
        if (!currentUpload) return;
        
        const progressBar = document.getElementById('upload-progress-bar');
        const statusText = document.getElementById('upload-status-text');
        const speedText = document.getElementById('upload-speed');
        const timeText = document.getElementById('upload-time');
        const percentageText = document.getElementById('upload-percentage');
        const remainingText = document.getElementById('upload-remaining');
        
        if (progressBar) progressBar.style.width = currentUpload.progress + '%';
        if (percentageText) percentageText.textContent = Math.round(currentUpload.progress) + '%';
        if (statusText) statusText.textContent = currentUpload.status;
        
        // Calculate speed and time
        if (uploadStartTime) {
            const elapsedTime = (Date.now() - uploadStartTime) / 1000; // seconds
            currentUpload.timeElapsed = elapsedTime;
            
            if (timeText) timeText.textContent = `${Math.round(elapsedTime)}s`;
            
            if (currentUpload.videoFile && elapsedTime > 0) {
                const uploadedBytes = (currentUpload.progress / 100) * currentUpload.videoFile.size;
                const speed = (uploadedBytes / 1024 / 1024) / elapsedTime; // MB/s
                currentUpload.speed = speed;
                
                if (speedText) speedText.textContent = `${speed.toFixed(2)} MB/s`;
                
                // Calculate remaining time
                if (currentUpload.progress < 100) {
                    const remainingBytes = currentUpload.videoFile.size - uploadedBytes;
                    const remainingTime = (remainingBytes / 1024 / 1024) / speed;
                    if (remainingText) remainingText.textContent = `${Math.round(remainingTime)}s`;
                } else {
                    if (remainingText) remainingText.textContent = '--';
                }
            }
        }
        
        updateUploadQueueDisplay();
    }

    function addToUploadQueue(posterFile, videoFile, title, description, year, duration) {
        const id = Date.now() + Math.random();
        const uploadItem = {
            id,
            posterFile,
            videoFile,
            title,
            description,
            year,
            duration,
            status: 'pending',
            progress: 0,
            speed: 0,
            timeElapsed: 0
        };
        
        uploadQueue.push(uploadItem);
        
        updateUploadQueueDisplay();
        
        // Start processing if not already uploading
        if (!currentUpload) {
            processNextUpload();
        }
    }

    function updateUploadQueueDisplay() {
        const queueContainer = document.getElementById('upload-queue-items');
        if (!queueContainer) return;
        
        if (uploadQueue.length === 0) {
            queueContainer.innerHTML = '<p>No uploads in queue</p>';
            return;
        }
        
        let html = '';
        uploadQueue.forEach(item => {
            html += `
                <div class="upload-item" data-id="${item.id}">
                    <div class="upload-item-header">
                        <div class="upload-item-title">${item.title}</div>
                        <div class="upload-item-status ${item.status}">${item.status}</div>
                    </div>
                    <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 10px;">
                        ${(item.videoFile.size / 1024 / 1024).toFixed(2)} MB  ${item.description.substring(0, 50)}...
                    </div>
                    <div class="progress-container" style="margin: 5px 0;">
                        <div class="progress-bar" style="width: ${item.progress}%;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-gray);">
                        <span>${Math.round(item.progress)}%</span>
                        <span>${item.speed.toFixed(2)} MB/s</span>
                        <span>${Math.round(item.timeElapsed)}s</span>
                    </div>
                </div>
            `;
        });
        
        queueContainer.innerHTML = html;
    }

    // =========== AUTHENTICATION FUNCTIONS ===========
    async function handleUserLogin(e) {
        e.preventDefault();
        console.log('Login form submitted');
        
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;
        
        if (!email || !password) {
            showNotification('Email and password are required', 'error');
            return;
        }
        
        showLoading(true);
        
        try {
            console.log('Attempting login for:', email);
            const response = await fetch(`${WASABI_ENDPOINT}/api/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({
                    email: email,
                    password: password
                }),
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            console.log('Login response:', data);
            
            if (data.success) {
                currentUser = data.user;
                
                if (data.user.isAdmin) {
                    isAdmin = true;
                    hideModal(loginModal);
                    showAdminPanel();
                    showNotification('Welcome Administrator!', 'success');
                } else {
                    hideModal(loginModal);
                    showMainPlatform();
                    showNotification('Login successful!', 'success');
                }
            } else {
                showNotification(data.error || 'Invalid email or password', 'error');
            }
        } catch (err) {
            console.error('Login error:', err);
            showNotification('Server error. Please try again later.', 'error');
        } finally {
            showLoading(false);
        }
    }

    async function handleUserRegister(e) {
        e.preventDefault();
        console.log('Register form submitted');
        
        const name = document.getElementById('register-name').value.trim();
        const email = document.getElementById('register-email').value.trim();
        const phone = document.getElementById('register-phone').value.trim();
        const password = document.getElementById('register-password').value;
        const confirmPassword = document.getElementById('register-confirm').value;
        
        // Validation
        if (!name) {
            showNotification('Name is required', 'error');
            return;
        }
        
        if (!email) {
            showNotification('Email is required', 'error');
            return;
        }
        
        if (!password) {
            showNotification('Password is required', 'error');
            return;
        }
        
        if (password !== confirmPassword) {
            showNotification('Passwords do not match', 'error');
            return;
        }
        
        if (password.length < 6) {
            showNotification('Password must be at least 6 characters', 'error');
            return;
        }
        
        showLoading(true);
        
        try {
            // Create user object
            const newUser = {
                name: name,
                email: email,
                phone: phone,
                password: password
            };
            
            console.log('Registering user:', newUser);
            
            // Send to server endpoint
            const response = await fetch(`${WASABI_ENDPOINT}/save-user`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify(newUser),
                mode: 'cors'
            });
            
            const data = await response.json();
            console.log('Registration response:', data);
            
            if (data.success) {
                showNotification(' Account created successfully! Please login.', 'success');
                hideModal(registerModal);
                showModal(loginModal);
                
                // Pre-fill the login email
                document.getElementById('login-email').value = email;
                e.target.reset();
            } else {
                showNotification(` ${data.error || 'Failed to create account'}`, 'error');
            }
        } catch (err) {
            console.error('Registration error:', err);
            showNotification(' Server error. Please try again later.', 'error');
        } finally {
            showLoading(false);
        }
    }

    async function handleLogout() {
        console.log('Logging out...');
        showLoading(true);
        
        try {
            await fetch(`${WASABI_ENDPOINT}/api/logout`, {
                method: 'POST',
                credentials: 'include',
                mode: 'cors'
            });
        } catch (err) {
            console.error('Logout error:', err);
        }
        
        currentUser = null;
        isAdmin = false;
        sessionStorage.removeItem('bfCinemaUser');
        landingPage.classList.remove('hidden');
        mainPlatform.classList.remove('active');
        adminPanel.classList.remove('active');
        showNotification('Logged out successfully', 'info');
        showLoading(false);
    }

    // =========== UI FUNCTIONS ===========
    function showModal(modal) {
        modal.classList.add('active');
    }

    function hideModal(modal) {
        modal.classList.remove('active');
        if (modal.querySelector('form')) {
            modal.querySelector('form').reset();
        }
    }

    function showMainPlatform() {
        console.log('Showing main platform...');
        landingPage.classList.add('hidden');
        adminPanel.classList.remove('active');
        mainPlatform.classList.add('active');
        
        showOnlySection('movies');
        loadUserData();
        loadMovies();
        showLoading(false);
    }

    function showAdminPanel() {
        console.log('Showing admin panel...');
        landingPage.classList.add('hidden');
        mainPlatform.classList.remove('active');
        adminPanel.classList.add('active');
        
        // Close sidebar on mobile initially
        if (window.innerWidth <= 992) {
            const sidebar = document.getElementById('admin-sidebar');
            const main = document.getElementById('admin-main');
            const overlay = document.getElementById('sidebar-overlay');
            if (sidebar) sidebar.classList.remove('active');
            if (main) main.classList.remove('sidebar-open');
            if (overlay) overlay.classList.remove('active');
        }
        
        showAdminSection('dashboard');
        refreshAdminData();
        showLoading(false);
    }

    function toggleMenu() {
        const menuDropdown = document.getElementById('menu-dropdown');
        if (menuDropdown) {
            menuDropdown.classList.toggle('active');
        }
    }

    function toggleAdminSidebar() {
        const sidebar = document.getElementById('admin-sidebar');
        const main = document.getElementById('admin-main');
        const overlay = document.getElementById('sidebar-overlay');
        
        if (sidebar && main && overlay) {
            const isActive = sidebar.classList.contains('active');
            
            if (isActive) {
                sidebar.classList.remove('active');
                main.classList.remove('sidebar-open');
                overlay.classList.remove('active');
            } else {
                sidebar.classList.add('active');
                main.classList.add('sidebar-open');
                overlay.classList.add('active');
            }
        }
    }

    function toggleTheme() {
        const isLight = document.body.classList.toggle('light-theme');
        localStorage.setItem('bfCinemaTheme', isLight ? 'light' : 'dark');
    }

    function showOnlySection(section) {
        console.log('Showing section:', section);
        const sections = ['movies-section', 'downloads-section', 'profile-section'];
        sections.forEach(sec => {
            const el = document.getElementById(sec);
            if (el) el.style.display = 'none';
        });
        
        const targetSection = document.getElementById(`${section}-section`);
        if (targetSection) {
            targetSection.style.display = 'block';
            if (section === 'movies') loadMovies();
            if (section === 'downloads') loadDownloads();
            if (section === 'profile') loadUserData();
        }
    }

    function showAdminSection(section) {
        console.log('Showing admin section:', section);
        
        // Hide all admin sections
        const sections = ['dashboard-section', 'movie-management-section', 'uploads-section', 'users-section', 'storage-section', 'finance-section'];
        sections.forEach(secId => {
            const sec = document.getElementById(secId);
            if (sec) {
                sec.style.display = 'none';
                sec.classList.remove('active');
            }
        });
        
        // Show target section
        const targetSection = document.getElementById(`${section}-section`);
        if (targetSection) {
            targetSection.style.display = 'block';
            setTimeout(() => {
                targetSection.classList.add('active');
            }, 10);
            
            // Update section title
            const title = document.getElementById('current-section-title');
            if (title) {
                const formattedTitle = section.replace(/-/g, ' ')
                    .split(' ')
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                    .join(' ');
                title.textContent = formattedTitle;
            }
            
            // Load section-specific data
            switch(section) {
                case 'dashboard':
                    refreshAdminData();
                    break;
                case 'movie-management':
                    loadAdminMovies();
                    break;
                case 'users':
                    loadUsersTable();
                    break;
                case 'storage':
                    loadStorageStats();
                    break;
                case 'finance':
                    loadFinanceData();
                    break;
            }
        }
    }

    function showNotification(message, type) {
        const messageEl = document.getElementById('notification-message');
        notification.className = `notification ${type}`;
        messageEl.textContent = message;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    function showLoading(show) {
        if (loadingOverlay) {
            loadingOverlay.classList.toggle('active', show);
        }
    }

    function updateCurrentDate() {
        const now = new Date();
        const options = { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        };
        const dateEl = document.getElementById('current-date');
        if (dateEl) {
            dateEl.textContent = now.toLocaleDateString('en-US', options);
        }
    }

    // =========== PAYMENT FUNCTIONS ===========
    function showPaymentModal(movieId, movieTitle) {
        const title = document.querySelector('#payment-modal .modal-title');
        
        if (title) title.textContent = `Purchase: ${movieTitle}`;
        document.getElementById('payment-movie-id').value = movieId;
        document.getElementById('payment-movie-title').value = movieTitle;
        document.getElementById('payment-phone').value = currentUser?.phone || '';
        document.getElementById('mpesa-message').value = '';
        document.getElementById('payment-status').innerHTML = '';
        
        // Reset to step 1
        document.getElementById('step-1-content').style.display = 'block';
        document.getElementById('step-2-content').style.display = 'none';
        document.querySelectorAll('.step').forEach(step => {
            step.classList.remove('active');
        });
        document.querySelector('.step[data-step="1"]').classList.add('active');
        document.querySelector('.step[data-step="1"] .step-circle').style.background = 'var(--primary)';
        document.querySelector('.step[data-step="2"] .step-circle').style.background = 'var(--text-gray)';
        document.querySelector('.step[data-step="3"] .step-circle').style.background = 'var(--text-gray)';
        
        showModal(paymentModal);
    }

    // UPDATED: Handle payment with downloads refresh
    async function handlePayment(e) {
        e.preventDefault();
        
        const movieId = document.getElementById('payment-movie-id').value;
        const movieTitle = document.getElementById('payment-movie-title').value;
        const phone = document.getElementById('payment-phone').value.trim();
        const transactionCode = document.getElementById('transaction-code').value.trim().toUpperCase();
        const mpesaMessage = document.getElementById('mpesa-message').value.trim();
        
        // Validate phone number format (254XXXXXXXXX)
        const phoneRegex = /^254[17]\d{8}$/;
        if (!phoneRegex.test(phone)) {
            showNotification('Please enter a valid MPesa phone number (format: 2547XXXXXXXX)', 'error');
            return;
        }
        
        // Validate transaction code format
        const codeRegex = /^[A-Z0-9]{10}$/;
        if (!codeRegex.test(transactionCode)) {
            showNotification('Transaction code must be exactly 10 characters (letters and numbers)', 'error');
            return;
        }
        
        if (!mpesaMessage) {
            showNotification('Please paste the MPesa message', 'error');
            return;
        }
        
        // Check if message contains required elements
        if (!mpesaMessage.includes('Confirmed') || !mpesaMessage.includes('Ksh')) {
            showNotification('Invalid MPesa message format. Please paste the complete message from MPesa.', 'error');
            return;
        }
        
        showLoading(true);
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/movies/${movieId}/verify-payment`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    phone: phone,
                    transaction_code: transactionCode,
                    mpesa_message: mpesaMessage
                }),
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('Payment verified successfully! Movie added to your downloads.', 'success');
                
                // Show receipt
                showReceipt(data.receipt);
                
                // Close payment modal
                hideModal(paymentModal);
                
                // IMPORTANT: Reload movies and downloads
                setTimeout(() => {
                    loadMovies(); // Refresh movies list to show "Watch Now" instead of "KES 30"
                    loadDownloads(); // Refresh downloads to show the newly purchased movie
                    
                    // Update profile stats
                    updateProfileStats();
                    
                    // If user is on downloads section, refresh it
                    const currentSection = document.querySelector('.menu-item.active');
                    if (currentSection && currentSection.dataset.section === 'downloads') {
                        loadDownloads();
                    }
                }, 1000);
                
            } else {
                document.getElementById('payment-status').innerHTML = `
                    <div style="color: var(--primary); padding: 15px; background: rgba(229, 9, 20, 0.1); border-radius: 8px; border: 1px solid var(--primary);">
                        <strong><i class="fas fa-exclamation-triangle"></i> Verification Failed:</strong><br>
                        ${data.error}
                    </div>
                `;
                showNotification('Payment verification failed: ' + data.error, 'error');
            }
        } catch (err) {
            console.error('Payment error:', err);
            document.getElementById('payment-status').innerHTML = `
                <div style="color: var(--danger); padding: 15px; background: rgba(231, 76, 60, 0.1); border-radius: 8px; border: 1px solid var(--danger);">
                    <strong><i class="fas fa-exclamation-circle"></i> Network Error:</strong><br>
                    Please check your internet connection and try again.
                </div>
            `;
            showNotification('Network error. Please try again.', 'error');
        } finally {
            showLoading(false);
        }
    }

    // UPDATED: Show receipt with Go to Downloads button
    function showReceipt(receiptData) {
        const receiptContent = document.getElementById('receipt-content');
        
        // Generate receipt HTML
        receiptContent.innerHTML = `
            <div style="max-width: 500px; margin: 0 auto; padding: 20px; border: 2px solid #333; font-family: 'Courier New', monospace; background: white; color: #333;">
                <div style="text-align: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #333;">
                    <h2 style="margin: 0; color: var(--primary); letter-spacing: 2px;">B/F CINEMA</h2>
                    <p style="margin: 5px 0; font-weight: bold;">Official Receipt</p>
                    <p style="margin: 5px 0; font-size: 0.9em; color: #666;">Receipt ID: ${receiptData.receipt_id}</p>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <p style="margin: 5px 0;"><strong>Transaction Code:</strong> ${receiptData.transaction_code}</p>
                    <p style="margin: 5px 0;"><strong>Date:</strong> ${receiptData.date}</p>
                    <p style="margin: 5px 0;"><strong>Time:</strong> ${receiptData.time}</p>
                    <p style="margin: 5px 0;"><strong>Status:</strong> <span style="color: green; font-weight: bold;">PAID </span></p>
                </div>
                
                <div style="margin-bottom: 15px; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                    <h4 style="margin: 0 0 10px 0; border-bottom: 1px solid #ddd; padding-bottom: 5px;">MOVIE PURCHASED</h4>
                    <p style="margin: 5px 0;"><strong>Title:</strong> ${receiptData.movie_title}</p>
                    <p style="margin: 5px 0;"><strong>Amount:</strong> KES ${receiptData.amount.toFixed(2)}</p>
                    <p style="margin: 5px 0; color: var(--success); font-weight: bold;">
                        <i class="fas fa-check-circle"></i> Added to your Downloads
                    </p>
                </div>
                
                <div style="margin-bottom: 15px; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                    <h4 style="margin: 0 0 10px 0; border-bottom: 1px solid #ddd; padding-bottom: 5px;">CUSTOMER DETAILS</h4>
                    <p style="margin: 5px 0;"><strong>Name:</strong> ${receiptData.user_name}</p>
                    <p style="margin: 5px 0;"><strong>Email:</strong> ${receiptData.user_email}</p>
                    <p style="margin: 5px 0;"><strong>Phone:</strong> ${receiptData.user_phone}</p>
                </div>
                
                ${receiptData.qr_code ? `
                <div style="text-align: center; margin: 20px 0; padding: 15px; border-top: 1px dashed #333; border-bottom: 1px dashed #333;">
                    <h4 style="margin: 0 0 10px 0;">RECEIPT QR CODE</h4>
                    <img src="${receiptData.qr_code}" alt="QR Code" style="width: 150px; height: 150px; border: 1px solid #ddd;">
                    <p style="margin: 10px 0 0 0; font-size: 0.8em; color: #666;">Scan to verify receipt</p>
                </div>
                ` : ''}
                
                <div style="text-align: center; margin-top: 20px; font-size: 0.9em; color: #666; border-top: 1px solid #ddd; padding-top: 15px;">
                    <p style="color: var(--success); font-weight: bold;">
                        <i class="fas fa-check-circle"></i> Your movie is now available in Downloads
                    </p>
                    <p>For support: bfCinemamovies@gmail.com | +254 700 505325</p>
                </div>
            </div>
        `;
        
        // Set up buttons
        const printBtn = document.getElementById('print-receipt-btn');
        const watchBtn = document.getElementById('watch-movie-btn');
        const downloadsBtn = document.getElementById('go-to-downloads-btn');
        
        if (printBtn) {
            printBtn.onclick = () => {
                window.print();
            };
        }
        
        if (watchBtn) {
            watchBtn.onclick = () => {
                hideModal(receiptModal);
                // Find and play the movie
                const movie = movies.find(m => m.id == receiptData.movie_id);
                if (movie) {
                    showVideoPlayer(movie);
                }
            };
        }
        
        if (downloadsBtn) {
            downloadsBtn.onclick = () => {
                hideModal(receiptModal);
                // Switch to downloads section
                showOnlySection('downloads');
                // Refresh downloads
                loadDownloads();
                // Update menu active state
                document.querySelectorAll('.menu-item[data-section]').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.section === 'downloads') {
                        item.classList.add('active');
                    }
                });
            };
        }
        
        // Show receipt modal
        showModal(receiptModal);
    }

    // =========== UPDATED LOAD MOVIES FUNCTION ===========
    async function loadMovies() {
        console.log('Loading movies...');
        const container = document.getElementById('movies-container');
        const noMovies = document.getElementById('no-movies');
        
        if (!container) return;
        
        showLoading(true);
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/movies`, {
                method: 'GET',
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            console.log('Movies response:', data);
            
            if (data.success && data.movies && data.movies.length > 0) {
                movies = data.movies;
                
                container.style.display = 'grid';
                container.innerHTML = '';
                
                data.movies.forEach(movie => {
                    // Check if poster exists
                    const posterUrl = movie.poster || 'https://images.unsplash.com/photo-1536440136628-849c177e76a1?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80';
                    
                    const movieCard = document.createElement('div');
                    movieCard.className = 'movie-card';
                    movieCard.innerHTML = `
                        <img src="${posterUrl}" alt="${movie.title}" class="movie-poster" 
                             onerror="this.src='https://images.unsplash.com/photo-1536440136628-849c177e76a1?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'">
                        <div class="movie-info">
                            <h3 class="movie-title">${movie.title}</h3>
                            <div class="movie-meta">
                                <span>${movie.year || 'N/A'}</span>
                                <span>${movie.duration || '120 min'}</span>
                                <span>${movie.views || 0} views</span>
                            </div>
                            <p style="color: var(--text-gray); font-size: 0.9rem; margin-top: 10px;">
                                ${movie.description || ''}
                            </p>
                            <div class="movie-actions">
                                <button class="btn btn-primary watch-btn" data-id="${movie.id}">
                                    <i class="fas fa-play"></i> ${movie.has_access || movie.free_preview ? 'Watch Now' : 'KES 30'}
                                </button>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(movieCard);
                });
                
                // Add event listeners
                container.querySelectorAll('.watch-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const movieId = btn.dataset.id;
                        const movie = movies.find(m => m.id == movieId);
                        if (movie) showVideoPlayer(movie);
                    });
                });
                
                if (noMovies) noMovies.style.display = 'none';
            } else {
                if (container) container.style.display = 'none';
                if (noMovies) noMovies.style.display = 'block';
            }
        } catch (err) {
            console.error('Failed to load movies:', err);
            if (container) container.style.display = 'none';
            if (noMovies) noMovies.style.display = 'block';
        } finally {
            showLoading(false);
        }
    }

    async function checkMovieAccess(movieId) {
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/movies/${movieId}/check-access`, {
                method: 'GET',
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            return data;
        } catch (err) {
            console.error('Check access error:', err);
            return { success: false, has_access: false };
        }
    }

    async function loadAdminMovies() {
        console.log('Loading admin movies...');
        const tbody = document.getElementById('admin-movies-table-body');
        if (!tbody) return;
        
        showLoading(true);
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/admin/movies`, {
                method: 'GET',
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            
            tbody.innerHTML = '';
            
            if (data.success && data.movies && data.movies.length > 0) {
                data.movies.forEach(movie => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <img src="${movie.poster_url}" 
                                 alt="${movie.title}" 
                                 style="width: 60px; height: 80px; object-fit: cover; border-radius: 5px;"
                                 onerror="this.src='https://via.placeholder.com/60x80?text=No+Poster'">
                        </td>
                        <td><strong>${movie.title}</strong></td>
                        <td style="max-width: 200px; font-size: 0.9rem;">
                            ${movie.description ? movie.description.substring(0, 100) + (movie.description.length > 100 ? '...' : '') : 'No description'}
                        </td>
                        <td>${movie.year || 'N/A'}</td>
                        <td>${movie.views || 0}</td>
                        <td>${movie.downloads || 0}</td>
                        <td><span class="badge">${movie.storage || 'wasabi'}</span></td>
                        <td>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="btn btn-danger btn-sm delete-movie-btn" data-id="${movie.id}">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Add delete event listeners
                tbody.querySelectorAll('.delete-movie-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const movieId = btn.dataset.id;
                        deleteMovie(movieId);
                    });
                });
            } else {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: var(--text-gray);">
                            <i class="fas fa-film" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                            <h3>No Movies Found</h3>
                            <p>Upload your first movie in the Uploads section</p>
                        </td>
                    </tr>
                `;
            }
        } catch (err) {
            console.error('Failed to load admin movies:', err);
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; padding: 40px; color: var(--text-gray);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                        <h3>Failed to Load Movies</h3>
                        <p>${err.message}</p>
                    </td>
                </tr>
            `;
        } finally {
            showLoading(false);
        }
    }

    async function deleteMovie(movieId) {
        if (!confirm('Are you sure you want to delete this movie?')) {
            return;
        }
        
        showLoading(true);
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/admin/movies/${movieId}`, {
                method: 'DELETE',
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('Movie deleted successfully', 'success');
                loadMovies();
                loadAdminMovies();
                refreshAdminData();
            } else {
                showNotification(data.error || 'Failed to delete movie', 'error');
            }
        } catch (err) {
            console.error(err);
            showNotification('Server error. Please try again later.', 'error');
        } finally {
            showLoading(false);
        }
    }

    async function downloadMovie(movieId) {
        if (!currentUser) {
            showNotification('Please login to download movies', 'error');
            return;
        }
        
        if (isAdmin) {
            showNotification('Admin cannot download movies', 'error');
            return;
        }
        
        showLoading(true);
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/movies/${movieId}/download`, {
                method: 'POST',
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('Download recorded successfully!', 'success');
                loadDownloads();
                updateProfileStats();
            } else {
                showNotification(data.error || 'Failed to download movie', 'error');
            }
        } catch (err) {
            console.error(err);
            showNotification('Server error. Please try again later.', 'error');
        } finally {
            showLoading(false);
        }
    }

    // =========== USER DATA FUNCTIONS ===========
    function loadUserData() {
        if (!currentUser) return;
        
        const menuUserName = document.getElementById('menu-user-name');
        const menuUserEmail = document.getElementById('menu-user-email');
        const profileAvatar = document.getElementById('profile-avatar');
        const profileName = document.getElementById('profile-name');
        const profileEmail = document.getElementById('profile-email');
        const profilePhone = document.getElementById('profile-phone');
        const memberSince = document.getElementById('member-since');
        
        if (menuUserName) menuUserName.textContent = currentUser.name;
        if (menuUserEmail) menuUserEmail.textContent = currentUser.email;
        if (profileAvatar) profileAvatar.textContent = currentUser.name.charAt(0).toUpperCase();
        if (profileName) profileName.textContent = currentUser.name;
        if (profileEmail) profileEmail.textContent = currentUser.email;
        if (profilePhone) profilePhone.textContent = currentUser.phone || 'N/A';
        
        if (memberSince && currentUser.createdAt) {
            const joinDate = new Date(currentUser.createdAt);
            memberSince.textContent = joinDate.toLocaleDateString();
            
            const today = new Date();
            const diffTime = Math.abs(today - joinDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const accountAge = document.getElementById('account-age');
            if (accountAge) accountAge.textContent = diffDays;
        }
        
        updateProfileStats();
    }

    async function updateProfileStats() {
        if (!currentUser || isAdmin) return;
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/user/profile`, {
                method: 'GET',
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            
            if (data.success) {
                const user = data.user;
                const moviesWatched = document.getElementById('movies-watched');
                const downloadsCount = document.getElementById('downloads-count');
                
                if (moviesWatched) moviesWatched.textContent = user.moviesWatched || 0;
                if (downloadsCount) downloadsCount.textContent = user.downloads || 0;
            }
        } catch (err) {
            console.error('Failed to update profile stats:', err);
        }
    }

    async function loadDownloads() {
        if (!currentUser || isAdmin) return;
        
        const container = document.getElementById('downloads-container');
        const noDownloads = document.getElementById('no-downloads');
        
        if (!container || !noDownloads) return;
        
        showLoading(true);
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/user/downloads`, {
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            
            if (data.success && data.downloads && data.downloads.length > 0) {
                container.style.display = 'grid';
                noDownloads.style.display = 'none';
                container.innerHTML = '';
                
                data.downloads.forEach(download => {
                    const movie = download.movieData;
                    const downloadCard = document.createElement('div');
                    downloadCard.className = 'movie-card';
                    downloadCard.innerHTML = `
                        <img src="${movie.poster}" alt="${movie.title}" class="movie-poster" 
                             onerror="this.src='https://images.unsplash.com/photo-1536440136628-849c177e76a1?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'">
                        <div class="movie-info">
                            <h3 class="movie-title">${movie.title}</h3>
                            <div class="movie-meta">
                                <span>${movie.year || 'N/A'}</span>
                                <span>${movie.duration || '120 min'}</span>
                            </div>
                            <p style="color: var(--text-gray); font-size: 0.9rem; margin-top: 10px;">
                                Downloaded: ${new Date(download.downloadedAt).toLocaleDateString()}
                            </p>
                            <div class="movie-actions">
                                <button class="btn btn-primary watch-download-btn" data-id="${download.movieId}">
                                    <i class="fas fa-play"></i> Watch
                                </button>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(downloadCard);
                });
                
                container.querySelectorAll('.watch-download-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const movieId = btn.dataset.id;
                        // Find the movie from our movies array
                        const movie = movies.find(m => m.id == movieId);
                        if (movie) showVideoPlayer(movie);
                    });
                });
            } else {
                container.style.display = 'none';
                noDownloads.style.display = 'block';
            }
        } catch (err) {
            console.error('Failed to load downloads:', err);
            container.style.display = 'none';
            noDownloads.style.display = 'block';
        } finally {
            showLoading(false);
        }
    }

    async function handleChangePassword(e) {
        e.preventDefault();
        
        const currentPassword = document.getElementById('current-password').value;
        const newPassword = document.getElementById('new-password').value;
        const confirmNewPassword = document.getElementById('confirm-new-password').value;
        
        if (newPassword !== confirmNewPassword) {
            showNotification('New passwords do not match', 'error');
            return;
        }
        
        if (newPassword.length < 6) {
            showNotification('New password must be at least 6 characters', 'error');
            return;
        }
        
        showLoading(true);
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/user/change-password`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    current_password: currentPassword,
                    new_password: newPassword
                }),
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('Password changed successfully', 'success');
                e.target.reset();
            } else {
                showNotification(data.error || 'Failed to change password', 'error');
            }
        } catch (err) {
            console.error('Change password error:', err);
            showNotification('Failed to change password', 'error');
        } finally {
            showLoading(false);
        }
    }

    // =========== ADMIN DATA FUNCTIONS ===========
    async function refreshAdminData() {
        showLoading(true);
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/admin/stats`, {
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            
            if (data.success) {
                const stats = data.stats;
                
                // Update statistics
                const totalMovies = document.getElementById('total-movies-admin');
                const totalUsers = document.getElementById('total-users-admin');
                const totalDownloads = document.getElementById('total-downloads-admin');
                const storageUsed = document.getElementById('storage-used-admin');
                
                if (totalMovies) totalMovies.textContent = stats.total_movies;
                if (totalUsers) totalUsers.textContent = stats.total_users;
                if (totalDownloads) totalDownloads.textContent = stats.total_downloads;
                if (storageUsed) storageUsed.textContent = `${stats.storage_used} GB`;
                
                // Update activity table
                const activityTable = document.getElementById('activity-table');
                if (activityTable) {
                    activityTable.innerHTML = '';
                    
                    if (stats.recent_activity && stats.recent_activity.length > 0) {
                        stats.recent_activity.forEach(activity => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${new Date(activity.time).toLocaleString()}</td>
                                <td>${activity.action}</td>
                                <td>${activity.user}</td>
                                <td>${typeof activity.details === 'object' ? JSON.stringify(activity.details) : activity.details}</td>
                            `;
                            activityTable.appendChild(row);
                        });
                    } else {
                        activityTable.innerHTML = `
                            <tr><td colspan="4" style="text-align: center; padding: 20px; color: var(--text-gray);">No recent activity</td></tr>
                        `;
                    }
                }
            } else {
                if (data.error === 'Admin access required') {
                    showNotification('Admin session expired. Please login again.', 'error');
                    handleLogout();
                }
            }
        } catch (err) {
            console.error('Failed to refresh admin data:', err);
        } finally {
            showLoading(false);
            updateCurrentDate();
        }
    }

    async function loadUsersTable() {
        const tbody = document.getElementById('users-table-body');
        if (!tbody) return;
        
        showLoading(true);
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/admin/users`, {
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            
            tbody.innerHTML = '';
            
            if (data.success && data.users && data.users.length > 0) {
                data.users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.phone || 'N/A'}</td>
                        <td>${new Date(user.joined).toLocaleDateString()}</td>
                        <td>${user.downloads}</td>
                        <td>
                            <button class="btn btn-danger btn-sm delete-user-btn" data-id="${user.id}">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Add delete event listeners
                tbody.querySelectorAll('.delete-user-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const userId = btn.dataset.id;
                        deleteUser(userId);
                    });
                });
            } else {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-gray);">
                            <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                            <h3>No Users Found</h3>
                        </td>
                    </tr>
                `;
            }
        } catch (err) {
            console.error('Failed to load users:', err);
            tbody.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-gray);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                        <h3>Failed to Load Users</h3>
                        <p>${err.message}</p>
                    </td>
                </tr>
            `;
        } finally {
            showLoading(false);
        }
    }

    function loadStorageStats() {
        const moviesCount = document.getElementById('movies-count-admin');
        const storageTotal = document.getElementById('storage-total-admin');
        const storageFree = document.getElementById('storage-free-admin');
        const storageCost = document.getElementById('storage-cost-admin');
        
        // Get movie count from loaded movies
        if (moviesCount) moviesCount.textContent = movies.length;
        if (storageTotal) storageTotal.textContent = '1 TB';
        
        if (storageFree) {
            const usedGB = movies.length * 1.5;
            const freeGB = 1024 - usedGB;
            storageFree.textContent = `${freeGB.toFixed(0)} GB`;
        }
        
        if (storageCost) {
            const usedGB = movies.length * 1.5;
            const monthlyCost = (usedGB / 1024) * 5.99;
            storageCost.textContent = `$${monthlyCost.toFixed(2)}`;
        }
    }

    async function deleteUser(userId) {
        if (!confirm('Are you sure you want to delete this user?')) {
            return;
        }
        
        showLoading(true);
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/admin/users/${userId}`, {
                method: 'DELETE',
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('User deleted successfully', 'success');
                loadUsersTable();
                refreshAdminData();
            } else {
                showNotification(data.error || 'Failed to delete user', 'error');
            }
        } catch (err) {
            console.error(err);
            showNotification('Server error. Please try again later.', 'error');
        } finally {
            showLoading(false);
        }
    }

    // =========== FINANCE FUNCTIONS ===========
    async function loadFinanceData() {
        console.log('Loading finance data...');
        const totalTransactions = document.getElementById('total-transactions');
        const totalRevenue = document.getElementById('total-revenue');
        const verifiedTransactions = document.getElementById('verified-transactions');
        const fraudulentTransactions = document.getElementById('fraudulent-transactions');
        const tbody = document.getElementById('transactions-table-body');
        
        if (!tbody) return;
        
        showLoading(true);
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/admin/transactions`, {
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            
            if (data.success) {
                const transactions = data.transactions;
                const stats = data.stats;
                
                // Update stats
                if (totalTransactions) totalTransactions.textContent = stats.total_transactions;
                if (totalRevenue) totalRevenue.textContent = `KES ${stats.total_revenue}`;
                if (verifiedTransactions) verifiedTransactions.textContent = stats.verified_transactions;
                if (fraudulentTransactions) fraudulentTransactions.textContent = stats.fraudulent_transactions;
                
                // Update transactions table
                tbody.innerHTML = '';
                
                if (transactions && transactions.length > 0) {
                    transactions.forEach(transaction => {
                        const row = document.createElement('tr');
                        const statusBadge = transaction.status === 'verified' ? 
                            `<span style="background: rgba(46, 204, 113, 0.2); color: var(--success); padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">Verified</span>` :
                            `<span style="background: rgba(231, 76, 60, 0.2); color: var(--danger); padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">Fraudulent</span>`;
                        
                        row.innerHTML = `
                            <td>${transaction.id}</td>
                            <td>${transaction.user_name || 'N/A'}</td>
                            <td>${transaction.movie_title || 'N/A'}</td>
                            <td><code>${transaction.transaction_code}</code></td>
                            <td style="max-width: 200px; font-size: 0.9rem;">${transaction.mpesa_message.substring(0, 100)}...</td>
                            <td><strong>KES ${transaction.amount}</strong></td>
                            <td>${new Date(transaction.created_at).toLocaleDateString()}</td>
                            <td>${statusBadge}</td>
                            <td>
                                <button class="btn btn-info btn-sm view-transaction-btn" data-id="${transaction.id}">
                                    <i class="fas fa-eye"></i> View
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                    
                    // Add view event listeners
                    tbody.querySelectorAll('.view-transaction-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const transactionId = btn.dataset.id;
                            viewTransaction(transactionId);
                        });
                    });
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 40px; color: var(--text-gray);">
                                <i class="fas fa-money-bill-wave" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                                <h3>No Transactions Found</h3>
                                <p>No MPesa transactions have been recorded yet</p>
                            </td>
                        </tr>
                    `;
                }
            } else {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: var(--text-gray);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                            <h3>Failed to Load Transactions</h3>
                            <p>${data.error || 'Server error'}</p>
                        </td>
                    </tr>
                `;
            }
        } catch (err) {
            console.error('Failed to load finance data:', err);
            tbody.innerHTML = `
                <tr>
                    <td colspan="9" style="text-align: center; padding: 40px; color: var(--text-gray);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                        <h3>Failed to Load Transactions</h3>
                        <p>${err.message}</p>
                    </td>
                </tr>
            `;
        } finally {
            showLoading(false);
        }
    }

    async function viewTransaction(transactionId) {
        showLoading(true);
        
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/api/admin/transactions/${transactionId}`, {
                credentials: 'include',
                mode: 'cors'
            });
            
            const data = await response.json();
            
            if (data.success) {
                const transaction = data.transaction;
                const transactionDetails = `
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px; margin-top: 10px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">Transaction Details</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <strong>Transaction ID:</strong><br>
                                ${transaction.id}
                            </div>
                            <div>
                                <strong>Date:</strong><br>
                                ${new Date(transaction.created_at).toLocaleString()}
                            </div>
                            <div>
                                <strong>User:</strong><br>
                                ${transaction.user_name || 'N/A'}
                            </div>
                            <div>
                                <strong>Movie:</strong><br>
                                ${transaction.movie_title || 'N/A'}
                            </div>
                            <div>
                                <strong>Transaction Code:</strong><br>
                                <code>${transaction.transaction_code}</code>
                            </div>
                            <div>
                                <strong>Amount:</strong><br>
                                KES ${transaction.amount}
                            </div>
                            <div>
                                <strong>Status:</strong><br>
                                ${transaction.status === 'verified' ? 
                                    '<span style="color: var(--success); font-weight: bold;">Verified</span>' : 
                                    '<span style="color: var(--danger); font-weight: bold;">Fraudulent</span>'}
                            </div>
                            <div>
                                <strong>Phone:</strong><br>
                                ${transaction.phone}
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <strong>Full MPesa Message:</strong><br>
                            <textarea style="width: 100%; padding: 10px; margin-top: 5px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); color: white; border-radius: 5px; min-height: 100px;" readonly>${transaction.mpesa_message}</textarea>
                        </div>
                    </div>
                `;
                
                showNotification(transactionDetails, 'info');
            } else {
                showNotification(data.error || 'Failed to load transaction details', 'error');
            }
        } catch (err) {
            console.error('Failed to view transaction:', err);
            showNotification('Failed to load transaction details', 'error');
        } finally {
            showLoading(false);
        }
    }

    // =========== WASABI FUNCTIONS ===========
    async function testWasabiConnection() {
        showLoading(true);
        try {
            const response = await fetch(`${WASABI_ENDPOINT}/test-connection`);
            const data = await response.json();
            const statusEl = document.getElementById('storage-status');
            
            if (data.success) {
                if (statusEl) {
                    statusEl.textContent = 'Active';
                    statusEl.style.color = '#2ecc71';
                }
                showNotification('Wasabi connection successful!', 'success');
            } else {
                throw new Error(data.error || 'Connection failed');
            }
        } catch (err) {
            const statusEl = document.getElementById('storage-status');
            if (statusEl) {
                statusEl.textContent = 'Inactive';
                statusEl.style.color = '#e74c3c';
            }
            showNotification(`Wasabi connection failed: ${err.message}`, 'error');
        } finally {
            showLoading(false);
        }
    }

    // =========== GLOBAL FUNCTION EXPORTS ===========
    window.deleteMovie = deleteMovie;
    window.deleteUser = deleteUser;
    window.testWasabiConnection = testWasabiConnection;
    window.loadFinanceData = loadFinanceData;
    window.viewTransaction = viewTransaction;
    window.showVideoPlayer = showVideoPlayer;
    window.showVideoPlayerStreaming = showVideoPlayerStreaming;
    window.tryAlternativePlayback = tryAlternativePlayback;

    console.log('B/F Cinema Platform Initialization Complete!');
    console.log('Using server endpoint:', WASABI_ENDPOINT);
    </script>
</body>
                                                                   </html>
